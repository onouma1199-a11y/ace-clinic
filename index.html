<!DOCTYPE html>

<html lang="th">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>ACE Clinic | Management System Luxury</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    

    <style>
/* üñ®Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå OPD Card ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤ A4 */
@media print {
    /* ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á */
    body * {
        visibility: hidden;
    }
    
    /* ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà OPD Card ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô */
    #opd-card-printable, #opd-card-printable * {
        visibility: visible;
    }
    
    /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤ A4 */
    #opd-card-printable {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        max-height: 14.8cm; /* üéØ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á A4 ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
        margin: 0;
        padding: 15px;
        border: 1px solid #eee !important; /* ‡πÉ‡∏™‡πà‡∏Ç‡∏≠‡∏ö‡∏ö‡∏≤‡∏á‡πÜ ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏•‡∏¥‡πâ‡∏ô */
        box-shadow: none !important;
        overflow: hidden;
    }

    /* ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏ñ‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */
    .no-print {
        display: none !important;
    }

    /* ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© */
    @page {
        size: A4 portrait; /* ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4 ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
        margin: 0.5cm;     /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏Ç‡∏≠‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© */
    }
}
/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏î‡∏≥ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏´‡∏£‡∏π ‡πÑ‡∏°‡πà‡πÄ‡∏≠‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
.course-tag {
    background: transparent !important; /* ‡πÄ‡∏≠‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡∏≠‡∏≠‡∏Å */
    color: #1a1a1a !important; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏î‡∏≥ */
    padding: 2px 0;
    font-weight: 500;
    display: block; /* ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏á‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î */
    font-size: 13px;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏î‡∏π Luxury */
.course-container {
    background: white;
    border-radius: 0.1rem; 
    border: none;
    overflow: hidden; 
    box-shadow: 0 15px 50px rgba(0,0,0,0.05);
    margin-top: 0 !important; 
}
.course-header-row {
    background-color: #D48197 !important; /* ‡∏ä‡∏°‡∏û‡∏π‡πÄ‡∏Ç‡πâ‡∏°‡∏´‡∏ß‡∏≤‡∏ô */
    color: white !important;
    font-weight: 800;
    font-size: 14px; /* ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
    letter-spacing: 1px;
}
/* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π */
.course-header-row th {
    border: none !important;
    padding-top: 12px !important;    /* üëà ‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏î‡∏à‡∏≤‡∏Å 25px ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ñ‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á */
    padding-bottom: 12px !important; /* üëà ‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏î‡∏à‡∏≤‡∏Å 25px */
    white-space: nowrap;            /* üëà ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ï‡∏Å‡∏ä‡πà‡∏≠‡∏á */
    text-align: center;             /* üëà ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏•‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° */
}
/* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏µ‡∏¢‡∏î */
.course-container tbody td {
    padding: 35px 10px !important;  /* üëà ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡πÑ‡∏ü‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ */
    font-size: 14px;
	vertical-align: middle !important;
}

/* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏°‡∏ô‡∏π‡∏•‡∏≠‡∏¢‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÑ‡∏î‡πâ (‡πÑ‡∏°‡πà‡πÇ‡∏î‡∏ô‡∏ï‡∏±‡∏î‡∏Ç‡∏≠‡∏ö) */
#dynamicContent .glass-card {
    overflow: visible !important;
}

/* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡∏î‡∏π‡πÅ‡∏û‡∏á */
[id^="action-menu-"] button {
    transition: 0.3s;
    white-space: nowrap; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ï‡∏±‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î */
}

/* --- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Responsive) --- */
.customer-photo {
    width: 45px !important;
    height: 45px !important;
    border-radius: 50% !important;
    object-fit: cover !important; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏£‡∏π‡∏õ‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß */
    border: 2px solid #D48197;
}

/* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏ô‡∏¥‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤‡πÑ‡∏î‡πâ */
.glass-card {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}
/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ö‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π */
.action-group {
    display: inline-flex;
    align-items: center;
    background-color: #D48197;
    border-radius: 9999px;
    padding: 2px;
}

/* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏∏‡∏î‡∏Ç‡∏≠‡∏ö‡∏à‡∏≠‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
[id^="action-menu-"] {
    animation: fadeInScale 0.2s ease-out;
}

@keyframes fadeInScale {
    from { opacity: 0; transform: scale(0.95) translateY(-10px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
}

.course-table th {
    font-weight: 600;
    color: #D48197;
    background-color: #FFF9FA;
    border-bottom: 1px solid #FEE2E7;
}

.course-table td {
    font-weight: 300; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÉ‡∏´‡πâ‡∏ú‡∏≠‡∏°‡∏•‡∏á */
}
/* üö´ ‡πÄ‡∏≠‡∏≤‡∏•‡∏π‡∏Å‡∏®‡∏£‡∏Ç‡∏∂‡πâ‡∏ô-‡∏•‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á Input Number ‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î */
input[type=number]::-webkit-inner-spin-button, 
input[type=number]::-webkit-outer-spin-button { 
    -webkit-appearance: none; 
    margin: 0; 
}
input[type=number] {
    -moz-appearance: textfield; /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Firefox */
}

        /* --- [1. GLOBAL STYLES] --- */

        body { font-family: 'Sarabun', sans-serif; background-color: #FDF7F8; color: #4B5563; }

        .gold-bg { background: linear-gradient(45deg, #C5A059, #E4C580); }

        .ace-pink { color: #D48197; }

        .ace-bg-pink { background-color: #D48197; }



        /* --- [2. NAVIGATION & UI] --- */

        .sidebar-item { transition: 0.3s; border-radius: 15px; cursor: pointer; display: flex; align-items: center; padding: 0.9rem 1.2rem; margin-bottom: 5px; font-weight: 600; }

        .sidebar-item:hover { background-color: #FFF0F3; color: #D48197; transform: translateX(5px); }

        .active-menu { background-color: #D48197 !important; color: white !important; shadow: 0 10px 15px -3px rgba(212, 129, 151, 0.4); }

        

        .glass-card { background: white; border-radius: 2rem; padding: 2rem; border: 1px solid #FDF2F4; box-shadow: 0 10px 30px rgba(0,0,0,0.03); }

        

        /* --- [3. MODAL & TABS] --- */

        .modal {

  display: none;

  position: fixed;

  z-index: 9999; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å */

  left: 0;

  top: 0;

  width: 100%;

  height: 100%;

  overflow: auto;

  background-color: rgba(0,0,0,0.4);

}

.modal-content {

  background-color: #fff;

  margin: 5% auto;

  padding: 20px;

  border-radius: 12px;

  width: 600px;

  max-width: 95%;

  position: relative;

}

     

     /* ‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÅ‡∏ó‡πá‡∏ö‡πÅ‡∏ö‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏ï‡πâ (Minimal Luxury) */
.profile-tab {
    padding: 12px 25px;
    font-weight: 400;
    color: #9CA3AF;
    background: transparent !important;
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease;
    cursor: pointer;
}

.profile-tab.active {
    color: #D48197 !important;
    border-bottom: 2px solid #D48197;
    background: transparent !important; /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏™ ‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ */
    font-weight: 600;
}
        

        .btn-period { transition: 0.3s; border-radius: 10px; padding: 0.5rem 1.2rem; font-weight: 700; font-size: 0.8rem; border: 1px solid #F1F1F1; }

        .btn-period.active { background-color: #D48197; color: white; border-color: #D48197; }



        ::-webkit-scrollbar { width: 6px; }

        ::-webkit-scrollbar-thumb { background: #D48197; border-radius: 10px; }



/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Header Control ‡πÉ‡∏´‡∏°‡πà */

        .live-indicator { width: 8px; height: 8px; background-color: #ff4d4f; border-radius: 50%; display: inline-block; animation: blink 1.5s infinite; }

        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.2; } 100% { opacity: 1; } }

        .control-group { display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; }
/* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ú‡∏≠‡∏°‡πÄ‡∏û‡∏£‡∏µ‡∏¢‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ */
body { font-family: 'Sarabun', sans-serif; font-weight: 300; }

/* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á "‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≠‡∏£‡πå‡∏™" ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏™‡∏ß‡∏¢ */
.course-container {
    background: white;
    border-radius: 2.5rem;
    border: 1px solid #F3F4F6;
    box-shadow: 0 10px 40px rgba(0,0,0,0.03); /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏≤‡πÉ‡∏´‡πâ‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏• */
    overflow: hidden;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß ‡πÅ‡∏•‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ä‡∏°‡∏û‡∏π‡πÄ‡∏Ç‡πâ‡∏°‡∏´‡∏ß‡∏≤‡∏ô */
.course-header-row {
    background-color: #D48197 !important; /* ‡∏ä‡∏°‡∏û‡∏π‡πÄ‡∏Ç‡πâ‡∏°‡∏´‡∏ß‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å */
    color: white !important; /* ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
    font-weight: 800; /* ‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤ */
    text-transform: uppercase;
    font-size: 13px; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á */
    letter-spacing: 1px;
}

/* ‡πÅ‡∏ñ‡∏°: ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏Ç‡∏≠‡∏ö‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏°‡∏ô‡∏£‡∏±‡∏ö‡∏Å‡∏±‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á */
.course-container thead tr th:first-child { border-top-left-radius: 2rem; }
.course-container thead tr th:last-child { border-top-right-radius: 2rem; }

/* ‡∏ö‡∏µ‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π (Tabs) ‡∏Å‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡∏î‡∏Å‡∏±‡∏ô */
.flex.flex-wrap.gap-2.mb-8 { 
    margin-bottom: 0.25rem !important; /* ‡∏•‡∏î‡∏à‡∏≤‡∏Å mb-8 ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÜ ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏ô‡∏¥‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Ñ‡πà‡∏∞ */
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏Ç‡∏≠‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ä‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å */
.course-container {
    margin-top: 0 !important;
position: relative;
    top: -1px;
}

/* --- üíé ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ã‡πà‡∏≠‡∏ô/‡πÇ‡∏ä‡∏ß‡πå (Luxury ACE Style) --- */
.sidebar-item span { font-style: normal !important; } /* ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏£‡∏á */
.submenu {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s ease-in-out, opacity 0.3s ease;
    padding-left: 1.5rem;
    opacity: 0;
}

/* ‡∏Ñ‡∏•‡∏≤‡∏™‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£ "‡∏Ñ‡∏•‡∏¥‡∏Å" */
.submenu.open {
    max-height: 250px; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏≠‡∏≠‡∏Å‡∏°‡∏≤ */
    opacity: 1;
    margin-top: 5px;
}

/* ‡∏´‡∏°‡∏∏‡∏ô‡∏•‡∏π‡∏Å‡∏®‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π */
.arrow-icon {
    transition: transform 0.3s;
}
.arrow-icon.rotate {
    transform: rotate(180deg);
}
    </style>

</head>

<body>

<div id="customerModal" 

class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">

  <div class="bg-white w-full max-w-3xl rounded-3xl p-8 max-h-[90vh] overflow-y-auto">



    <h2 class="text-2xl font-bold mb-6 text-purple-700">

      <span id="modalTitle">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</span>

    </h2>



    <div class="space-y-4">



      <input id="modalHN" placeholder="HN (‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)"

        class="w-full border px-4 py-3 rounded-xl">



      <div class="grid grid-cols-2 gap-4">

        <input id="modalFirstName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á *"

          class="border px-4 py-3 rounded-xl">

        <input id="modalLastName" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *"

          class="border px-4 py-3 rounded-xl">

      </div>



      <input id="modalNickname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô"

        class="w-full border px-4 py-3 rounded-xl">



      <input id="modalPhone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ *"

        class="w-full border px-4 py-3 rounded-xl">



      <input id="modalCitizenId" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô"

        class="w-full border px-4 py-3 rounded-xl">



      <textarea id="modalAddress" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà"

        class="w-full border px-4 py-3 rounded-xl"></textarea>



      <input id="modalLine" placeholder="Line UID"

        class="w-full border px-4 py-3 rounded-xl">



      <div class="grid grid-cols-2 gap-4">

        <select id="modalBranch" class="border px-4 py-3 rounded-xl">

          <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤ --</option>

          <option value="‡∏™‡∏≤‡∏Ç‡∏≤‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ</option>

          <option value="‡∏™‡∏≤‡∏Ç‡∏≤‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ</option>

          <option value="‡∏™‡∏≤‡∏Ç‡∏≤‡∏≠‡∏∏‡∏î‡∏°‡∏™‡∏∏‡∏Ç">‡∏™‡∏≤‡∏Ç‡∏≤‡∏≠‡∏∏‡∏î‡∏°‡∏™‡∏∏‡∏Ç</option>

        </select>



        <select id="modalStatus" class="border px-4 py-3 rounded-xl">

          <option value="‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>

          <option value="‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>

        </select>

      </div>



    </div>


    <div class="flex justify-end gap-4 mt-6">

      <button type="button" class="btn-cancel" onclick="closeModal()">

  ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å

</button>



      <button onclick="saveCustomer()"

        class="px-6 py-3 bg-pink-600 text-white rounded-xl">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>

    </div>



  </div>

</div>



   <div id="loginPage" class="min-h-screen flex items-center justify-center p-4 bg-[#FDF7F8] bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
        <div class="bg-white p-10 rounded-[3rem] shadow-2xl w-full max-w-md border border-[#E4C580]/30 text-center animate-in fade-in zoom-in duration-500">
            <img src="ace-logo.jpg" alt="ACE CLINIC" class="w-32 mx-auto mb-4">
            <h1 class="text-2xl font-bold tracking-tighter uppercase text-[#D48197] mb-1">ACE CLINIC - ‡πÄ‡∏≠‡∏ã ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å</h1>
            <p class="text-[#C5A059] font-bold tracking-[0.2em] text-[10px] mb-10 uppercase">Management System</p>
            
            <div class="space-y-6 text-left">
                <div class="space-y-1">
                    <label class="text-[11px] font-bold text-[#D48197] ml-2 uppercase tracking-wider">‡∏≠‡∏µ‡πÄ‡∏°‡∏• / ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                    <input type="text" id="uIn" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" 
                        class="w-full px-5 py-4 rounded-2xl border border-pink-100 outline-none focus:ring-2 focus:ring-[#D48197] font-normal text-slate-600 transition-all">
                </div>

                <div class="space-y-1">
                    <label class="text-[11px] font-bold text-[#D48197] ml-2 uppercase tracking-wider">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="pIn" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" 
                        class="w-full px-5 py-4 rounded-2xl border border-pink-100 outline-none focus:ring-2 focus:ring-[#D48197] font-normal text-slate-600 transition-all">
                </div>

                <button onclick="doLogin()" 
                    class="w-full gold-bg text-white font-bold py-4 rounded-2xl shadow-lg mt-4 hover:brightness-110 active:scale-[0.98] transition-all text-lg uppercase tracking-widest">
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>

                <p class="text-center text-[10px] text-gray-400 mt-6 font-normal">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà? 
                    <span class="text-[#D48197] cursor-pointer font-bold hover:underline" onclick="alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô')">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</span>
                </p>
            </div>
        </div>
    </div>


   <div id="mainDashboard" class="hidden min-h-screen flex flex-col md:flex-row">

        <aside class="w-80 bg-white shadow-2xl border-r border-pink-50 flex flex-col p-6 z-50">

            <div class="px-4 py-8 text-center border-b border-pink-50 mb-8 font-black">

                <img src="ace-logo.jpg" alt="ACE CLINIC" class="w-32 mx-auto mb-3">

                <div id="userBranchBadge" class="inline-block px-4 py-1 rounded-full gold-bg text-white text-[10px] uppercase italic tracking-widest font-black">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ</div>

            </div>

            

            <nav id="menuContainer" class="flex-1 space-y-2 overflow-y-auto font-black italic text-sm uppercase"></nav>

            

            <div class="mt-auto pt-6 border-t border-pink-50">

                <div class="flex items-center gap-3 p-3 rounded-2xl bg-pink-50/50 font-black italic">

                    <div id="userInitial" class="w-10 h-10 rounded-full bg-[#D48197] flex items-center justify-center text-white text-xs uppercase font-black">‡∏≠‡∏ô</div>

                    <div>

                        <p id="userNameLabel" class="text-[11px] text-gray-700 uppercase tracking-tighter font-black italic"></p>

                        <p onclick="location.reload()" class="text-[10px] text-red-400 cursor-pointer hover:underline uppercase italic font-black">Logout</p>

                    </div>

                </div>

            </div>

        </aside>



       <main class="flex-1 p-10 overflow-y-auto bg-[#FDF7F8]">

           <header class="bg-white px-8 py-4 flex flex-wrap items-center justify-between border-b relative z-10 rounded-3xl mb-8 shadow-sm">

    <div class="flex items-center gap-6">

        <h1 id="pageTitle" class="text-xl ace-pink uppercase font-black italic">DASHBOARD</h1>

        <div class="flex items-center gap-2 bg-slate-50 px-4 py-2 rounded-xl border border-pink-100">

            <span class="text-xs font-bold text-gray-400">üìÖ</span>

            <input type="date" id="headerDatePicker" class="bg-transparent text-xs font-black outline-none cursor-pointer" onchange="refreshAllData()">

        </div>

        <div class="text-[10px] font-bold text-gray-400 uppercase italic">

            ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="headerLastUpdate" class="text-slate-700">--:--:--</span>

        </div>

    </div>



    <div class="flex bg-slate-100 p-1 rounded-xl border border-pink-50">

        <button class="btn-period active" onclick="changePeriod('day', this)">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>

        <button class="btn-period" onclick="changePeriod('month', this)">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>

        <button class="btn-period" onclick="changePeriod('year', this)">‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</button>

    </div>



    <div class="flex items-center gap-4">

        <button class="bg-red-50 text-red-500 px-4 py-2 rounded-xl text-xs font-black flex items-center gap-2 hover:bg-red-100 transition-all border border-red-100">

            <span class="live-indicator"></span> LIVE

        </button>

        <button onclick="refreshAllData()" class="bg-slate-50 text-slate-500 p-2 rounded-xl border border-pink-50 hover:bg-slate-100 transition-all shadow-sm">üîÑ</button>

        

        <div class="relative group ml-2 border-l pl-4">

            <button class="text-2xl hover:scale-110 transition-transform">üè†</button>

            <div class="hidden group-hover:block absolute right-0 mt-1 w-48 bg-white border border-pink-100 rounded-2xl shadow-2xl z-[150] overflow-hidden">

                <p class="p-3 text-[10px] font-black text-gray-400 border-b uppercase">‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>

                <button class="w-full text-left p-3 text-xs font-bold hover:bg-pink-50 border-b" onclick="alert('‡∏™‡∏≤‡∏Ç‡∏≤‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ')">üìç ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ</button>

                <button class="w-full text-left p-3 text-xs font-bold hover:bg-pink-50 border-b" onclick="alert('‡∏™‡∏≤‡∏Ç‡∏≤‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ')">üìç ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ</button>

                <button class="w-full text-left p-3 text-xs font-bold hover:bg-pink-50" onclick="alert('‡∏™‡∏≤‡∏Ç‡∏≤‡∏≠‡∏∏‡∏î‡∏°‡∏™‡∏∏‡∏Ç')">üìç ‡∏™‡∏≤‡∏Ç‡∏≤‡∏≠‡∏∏‡∏î‡∏°‡∏™‡∏∏‡∏Ç</button>

            </div>

        </div>

    </div>

</header>

            

            <div id="dynamicContent" class="animate-in fade-in duration-500"></div>

        </main>

    </div>       



    <script>

//‡∏ä‡πà‡∏≠‡∏á‡∏´‡∏±‡∏ß‡∏ö‡∏¥‡∏• ‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤///
const productMaster = [
    { name: "‡∏Å‡∏•‡∏¥‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡πå 2 ‡∏ã‡∏µ‡∏ã‡∏µ", price: 3500, category: "course" },
    { name: "‡πÄ‡∏•‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏™", price: 1500, category: "course" },
    { name: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏•‡∏î‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö", price: 150, category: "medicine" },
    { name: "‡∏Ñ‡∏£‡∏µ‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏ú‡∏¥‡∏ß ACE", price: 450, category: "medicine" }
];

window.openBillingTab = function(customerName) {
    currentBillItems = [];
    const body = document.getElementById('profileTabBody');
    document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));

    body.innerHTML = `
        <div class="animate-in fade-in duration-500 p-8 bg-white min-h-full font-bold">
            
            <div class="flex justify-between items-start mb-8">
                <div>
                    <h4 class="text-3xl text-[#FF4B91] font-bold">üßæ ‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à / ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•‡πÉ‡∏´‡∏°‡πà</h4>
                    <p class="text-slate-400 text-xs mt-1 uppercase tracking-widest font-bold">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${customerName}</p>
                </div>
                <button onclick="switchProfileTab(1)" 
                    class="bg-pink-50 text-[#FF4B91] px-4 py-2 rounded-xl text-xs hover:bg-[#FF4B91] hover:text-white transition-all shadow-sm border border-pink-100 font-bold">
                    ‚úï ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 text-left">
                <div class="space-y-2">
                    <label class="text-xs text-[#FF4B91] font-bold ml-1">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•</label>
                    <input type="date" id="billDate" value="${new Date().toISOString().split('T')[0]}" 
                        class="w-full bg-[#FFF0F5] border border-pink-100 rounded-2xl p-4 text-sm text-slate-700 outline-none font-bold focus:border-[#FF4B91]">
                </div>
                <div class="space-y-2 text-left">
    <label class="text-xs text-[#FF4B91] font-bold ml-1">üí≥ ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</label>
    <select id="billPaymentMethod" 
        onchange="window.selectedPaymentMethod = this.value"
        class="w-full bg-[#FFF0F5] border border-pink-100 rounded-2xl p-4 text-sm text-slate-700 outline-none font-bold focus:border-[#FF4B91] appearance-none cursor-pointer">
        <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á --</option>
        <option value="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</option>
        <option value="‡πÇ‡∏≠‡∏ô (QR)">‡πÇ‡∏≠‡∏ô (QR)</option>
        <option value="‡πÇ‡∏≠‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó">‡πÇ‡∏≠‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</option>
        <option value="‡∏£‡∏π‡∏î‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï">‡∏£‡∏π‡∏î‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</option>
        <option value="Shopee">Shopee</option>
        <option value="Gowabi">Gowabi</option>
    </select>
</div>
</div>

            <div class="bg-[#FFF0F5] rounded-[2.5rem] p-8 mb-8 relative border-2 border-dashed border-[#FF4B91]/20 text-left">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-5 items-end">
                    <div class="lg:col-span-5 space-y-2 relative">
                        <label class="text-xs text-[#FF4B91] ml-1 font-bold">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏≠‡∏£‡πå‡∏™ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏¢‡∏≤</label>
                        <input type="text" id="itemName" oninput="searchProduct(this.value)" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£..." 
                            class="w-full bg-white border border-pink-100 rounded-2xl p-4 text-sm text-slate-700 outline-none shadow-sm font-bold focus:border-[#FF4B91]">
                        <div id="searchResult" class="absolute z-50 w-full bg-white shadow-xl rounded-2xl mt-1 hidden border border-pink-50 max-h-48 overflow-y-auto font-bold"></div>
                    </div>

                    <div class="lg:col-span-3 space-y-2">
                        <label class="text-xs text-[#FF4B91] ml-1 font-bold text-center block">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ø)</label>
                        <input type="number" id="billPrice" placeholder="0.00" 
                            class="w-full bg-white border border-pink-100 rounded-2xl p-4 text-sm text-[#FF4B91] font-black outline-none shadow-sm text-center">
                    </div>

                    <div class="lg:col-span-2 space-y-2">
                        <label class="text-xs text-[#FF4B91] ml-1 font-bold text-center block">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
                        <input type="number" id="billQty" value="1" 
                            class="w-full bg-white border border-pink-100 rounded-2xl p-4 text-sm text-[#FF4B91] font-black outline-none shadow-sm text-center">
                    </div>

                    <div class="lg:col-span-2">
                        <button onclick="addItemToBill()" class="w-full bg-[#FF4B91] text-white py-4 rounded-2xl text-[11px] hover:bg-[#E63980] transition-all shadow-lg font-bold uppercase">
                            + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ö‡∏¥‡∏•
                        </button>
                    </div>
                </div>
            </div>

            <div class="mb-8 overflow-hidden rounded-[1.5rem] border border-pink-50 shadow-sm">
                <table class="w-full text-left font-bold">
                    <thead class="bg-[#FFF0F5] text-[11px] text-[#FF4B91] uppercase tracking-wider">
                        <tr>
                            <th class="p-4">‡∏´‡∏°‡∏ß‡∏î</th>
                            <th class="p-4">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ / ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th class="p-4 text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                            <th class="p-4 text-right">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                            <th class="p-4 text-right">‡∏£‡∏ß‡∏° (‡∏ø)</th>
                            <th class="p-4 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="billItemsList" class="text-[13px] text-slate-600 font-bold">
                        <tr><td colspan="6" class="p-8 text-center text-slate-300 font-bold">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="flex flex-col md:flex-row justify-between items-end border-t border-pink-50 pt-8 gap-6">
                <div class="text-right md:text-left">
                    <p class="text-xs text-slate-400 font-bold uppercase">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞</p>
                    <h5 id="grandTotalDisplay" class="text-6xl text-[#FF4B91] font-bold tracking-tighter">‡∏ø0.00</h5>
                </div>
                <button onclick="confirmFinalPayment()" 
                    class="w-full md:w-auto bg-[#FF4B91] text-white px-16 py-5 rounded-[2rem] text-sm shadow-xl hover:bg-[#E63980] transition-all font-bold uppercase tracking-widest">
                    ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                </button>
            </div>
        </div>
    `;
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Auto-complete)
window.searchProduct = function(val) {
    const resDiv = document.getElementById('searchResult');
    if (!val) { resDiv.classList.add('hidden'); return; }
    
    const matches = productMaster.filter(p => p.name.includes(val));
    if (matches.length > 0) {
        resDiv.innerHTML = matches.map(p => `
            <div onclick="selectProduct('${p.name}', ${p.price}, '${p.category}')" 
                class="p-4 hover:bg-pink-100 cursor-pointer border-b border-pink-50 flex justify-between items-center bg-white shadow-sm transition-all">
                <span class="text-sm font-bold text-slate-900">${p.name}</span>
                <span class="text-[10px] bg-slate-200 text-slate-600 px-3 py-1 rounded-full font-bold uppercase">
                    ${p.category === 'medicine' ? '‡∏¢‡∏≤/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤' : '‡∏Ñ‡∏≠‡∏£‡πå‡∏™'}
                </span>
            </div>
        `).join('');
        resDiv.classList.remove('hidden');
    } else {
        resDiv.classList.add('hidden');
    }
};

window.selectProduct = function(name, price, cat) {
    document.getElementById('itemName').value = name;
    document.getElementById('billPrice').value = price;
    document.getElementById('searchResult').classList.add('hidden');
    document.getElementById('itemName').dataset.category = cat;
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢)
window.addItemToBill = function() {
    const name = document.getElementById('itemName').value;
    const price = parseFloat(document.getElementById('billPrice').value) || 0;
    const qty = parseFloat(document.getElementById('billQty').value) || 0;
    const cat = document.getElementById('itemName').dataset.category || 'general';

    if (!name || price <= 0) return;

    currentBillItems.push({ name, price, qty, cat, total: price * qty });
    renderBillItems();
    
    document.getElementById('itemName').value = '';
    document.getElementById('billPrice').value = '';
    document.getElementById('billQty').value = '1';
};
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏∞)
function renderBillItems() {
    const listBody = document.getElementById('billItemsList');
    let grandTotal = 0;

    if (currentBillItems.length === 0) {
        listBody.innerHTML = `<tr><td colspan="6" class="p-8 text-center text-slate-300 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</td></tr>`;
    } else {
        listBody.innerHTML = currentBillItems.map((item, index) => {
            grandTotal += item.total;
            return `
                <tr class="border-b border-slate-50 hover:bg-pink-50/20 transition-all font-bold">
                    <td class="p-4"><span class="bg-slate-100 px-2 py-1 rounded-lg text-[10px] uppercase">${item.cat === 'medicine' ? '‡∏¢‡∏≤/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤' : '‡∏Ñ‡∏≠‡∏£‡πå‡∏™'}</span></td>
                    <td class="p-4 text-slate-700">${item.name}</td>
                    <td class="p-4 text-center text-slate-600">${item.qty}</td>
                    <td class="p-4 text-right text-slate-600">‡∏ø${item.price.toLocaleString()}</td>
                    <td class="p-4 text-right ace-pink">‡∏ø${item.total.toLocaleString()}</td>
                   <td class="p-4 text-center">
    <button onclick='viewReceiptDetail(${JSON.stringify(b)})' 
            class="bg-slate-100 p-2 rounded-lg hover:bg-pink-100 transition-all">üëÅÔ∏è</button>
</td>
                </tr>
            `;
        }).join('');
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
    const formatter = new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB' });
    document.getElementById('grandTotalDisplay').innerText = formatter.format(grandTotal);
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å
window.removeItemFromBill = function(index) {
    currentBillItems.splice(index, 1);
    renderBillItems();
};

window.viewReceiptDetail = function(billData) {
    if (typeof showReceiptPreview === 'function') {
        showReceiptPreview(billData);
    } else {
        alert("‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡∏¥‡∏•: " + billData.customer + "\n‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: " + billData.total);
    }
};



        /* --- [4.1 DATA: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö] --- */

        const users = [

            { email: '1111', pass: '1111', name: '‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏£‡∏≠‡∏∏‡∏°‡∏≤', role: 'admin', branch: '‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤' },

            { email: 'staff@ace.com', pass: '1111', name: '‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏à‡∏µ‡πä‡∏¢‡∏ö', role: 'staff', branch: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ' },

            { email: 'account@ace.com', pass: '2222', name: '‡∏û‡∏µ‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ', role: 'accounting', branch: '‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á' }

        ];



       const menuConfig = [
    { id: 1, n: 'Dashboard ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°', i: 'üìä', roles: ['admin', 'accounting'] },
    { id: 2, n: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥', i: 'üë•', roles: ['admin', 'staff'] },
    
    // --- üíé ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏Ñ‡πà‡∏∞) ---
    { id: 'header', n: '‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ / ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à', i: 'üßæ', roles: ['admin', 'staff'] }, 
    { id: 3, n: '‡∏ï‡∏µ‡∏ö‡∏¥‡∏•‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (INCOMING)', i:'',roles: ['admin', 'staff'] },
    { id: 9, n: '‡∏ï‡∏µ‡∏ö‡∏¥‡∏•‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (OUTGOING)', i:'',roles: ['admin', 'staff'] },
    // ----------------------------------------------------

    { id: 4, n: '‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢', i: 'üìÖ', roles: ['admin', 'staff'] },
    { id: 5, n: '‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', i: '‚ú®', roles: ['admin', 'staff'] },
    { id: 6, n: '‡πÄ‡∏°‡∏ô‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô/‡∏Å‡∏£‡∏≤‡∏ü', i: 'üìà', roles: ['admin', 'accounting'] },
    { id: 7, n: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô', i: 'ü©∫', roles: ['admin'] },
    { id: 8, n: '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö', i: '‚öôÔ∏è', roles: ['admin'] }
];


        // üéØ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
let customerDB = JSON.parse(localStorage.getItem('customerDB')) || [
    {
        hn: "HN0001",
        fullname: "‡∏≠‡∏±‡∏Ñ‡∏£‡∏û‡∏• ‡∏û‡∏•‡∏±‡∏ö‡∏û‡∏•‡∏≤",
        nickname: "‡∏ï‡πâ‡∏ô",
        phone: "0971375498",
        branch: "‡∏™‡∏≤‡∏Ç‡∏≤‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ",
        photo: "",
        courses: [], // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏£‡πå‡∏™
        createdAt: "11/06/2024"
    },
    {
        hn: "HN0002",
        fullname: "‡∏ò‡∏ô‡πÇ‡∏ä‡∏ï‡∏¥ ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏ä‡∏£",
        nickname: "‡πÇ‡∏ä‡∏ï‡∏¥",
        phone: "0952826296",
        branch: "‡∏™‡∏≤‡∏Ç‡∏≤‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ",
        photo: "",
        courses: [], // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏£‡πå‡∏™
        createdAt: "11/06/2024"
    }
];


 let editingIndex = null;



function openModalForEdit(index){

  editingIndex = index;

  const c = customerDB[index];



  const modal = document.getElementById("customerModal");



  modal.classList.remove("hidden");

  modal.classList.add("flex");



  document.getElementById("modalTitle").innerText = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤";



  document.getElementById("modalHN").value = c.hn || "";

  document.getElementById("modalFirstName").value = c.firstName || "";

  document.getElementById("modalLastName").value = c.lastName || "";

  document.getElementById("modalNickname").value = c.nickname || "";

  document.getElementById("modalPhone").value = c.phone || "";

}



function saveCustomer(){



  const firstName = document.getElementById("modalFirstName").value.trim();

  const lastName = document.getElementById("modalLastName").value.trim();

  const phone = document.getElementById("modalPhone").value.trim();



  if(!firstName || !lastName || !phone){

    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ *");

    return;

  }



  const data = {

    hn: document.getElementById("modalHN").value || 

        "HN" + String(customerDB.length + 1).padStart(4,'0'),

    firstName,

    lastName,

    fullname: firstName + " " + lastName,

    nickname: document.getElementById("modalNickname").value,

    phone,

    citizenId: document.getElementById("modalCitizenId").value,

    address: document.getElementById("modalAddress").value,

    line: document.getElementById("modalLine").value,

    branch: document.getElementById("modalBranch").value,

    status: document.getElementById("modalStatus").value,

    createdAt: new Date().toLocaleDateString("th-TH")

  };



  if(editingIndex !== null){

    customerDB[editingIndex] = data;

  }else{

    customerDB.push(data);

  }



  localStorage.setItem("customerDB", JSON.stringify(customerDB));

  renderCustomerTable(customerDB);

  closeModal();

}



function clearModal(){

  document.getElementById("modalHN").value = "";

  document.getElementById("modalFirstName").value = "";

  document.getElementById("modalLastName").value = "";

  document.getElementById("modalNickname").value = "";

  document.getElementById("modalPhone").value = "";

  document.getElementById("modalCitizenId").value = "";

  document.getElementById("modalAddress").value = "";

  document.getElementById("modalLine").value = "";

  document.getElementById("modalBranch").value = "";

  document.getElementById("modalStatus").value = "‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";

}

function closeModal(){

  const modal = document.getElementById("customerModal");

  modal.classList.add("hidden");

  modal.classList.remove("flex");

  clearModal();

}

let hnRunning = localStorage.getItem("hnRunning")

    ? parseInt(localStorage.getItem("hnRunning"))

    : 1;



function generateHN() {



    const year = new Date().getFullYear().toString().slice(-2);

    const runningNumber = String(hnRunning).padStart(4, "0");



    const hn = "HN" + year + runningNumber;



    document.getElementById("modalHN").value = hn;



    hnRunning++;

    localStorage.setItem("hnRunning", hnRunning);

}



        /* --- [4.2 CORE SYSTEM: ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å] --- */

        function doLogin() {

            const u = document.getElementById('uIn').value;

            const p = document.getElementById('pIn').value;

            const user = users.find(x => x.email === u && x.pass === p);

            if (user) {

                document.getElementById('loginPage').classList.add('hidden');

                document.getElementById('mainDashboard').classList.remove('hidden');

                document.getElementById('userNameLabel').innerText = `${user.name} (${user.role.toUpperCase()})`;

                document.getElementById('userInitial').innerText = user.name.substring(0, 2);

                renderMenuByRole(user.role);

                loadPage(1, 'Dashboard ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°');

            } else { 

                alert("‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); 

            }

        }



       function renderMenuByRole(role) {
    const container = document.getElementById('menuContainer');
    // ‡∏î‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ (role)
    const allowedMenu = menuConfig.filter(m => m.roles.includes(role));
    
    let menuHtml = '';
    
    allowedMenu.forEach(m => {
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å "‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ / ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à" ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏•‡∏¥‡∏Å
        if (m.id === 'header') {
            menuHtml += `
                <div class="menu-group">
                    <div class="sidebar-item bg-slate-50/80 cursor-pointer flex justify-between items-center" onclick="toggleBillingMenu()">
                        <div class="flex items-center">
                            <span class="mr-3 text-xl">${m.i}</span><span class="text-sm font-bold uppercase">${m.n}</span>
                        </div>
                        <span id="billingArrow" class="arrow-icon text-[10px]">‚ñº</span>
                    </div>
                    <div id="billingSubmenu" class="submenu">`;
        } 
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏¢‡πà‡∏≠‡∏¢ (‡πÄ‡∏•‡∏Ç 3 ‡πÅ‡∏•‡∏∞ 9) ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
        else if (m.id === 3 || m.id === 9) {
            menuHtml += `
                <div class="sidebar-item mb-1 hover:translate-x-2 transition-transform" id="menu-${m.id}" onclick="loadPage(${m.id}, '${m.n}')">
                    <span class="mr-3 text-lg">${m.i}</span><span class="text-[11px] font-bold uppercase">${m.n}</span>
                </div>`;
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏ô‡∏π 9 (‡∏≠‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°) ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î Tag div
            if (m.id === 9) menuHtml += `</div></div>`;
        } 
        // ‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏≠‡∏∑‡πà‡∏ô‡πÜ (1, 2, 4, 5, 6, 7, 8) ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏õ‡∏Å‡∏ï‡∏¥
        else {
            menuHtml += `
                <div class="sidebar-item" id="menu-${m.id}" onclick="loadPage(${m.id}, '${m.n}')">
                    <span class="mr-3 text-xl">${m.i}</span><span class="text-sm font-bold uppercase">${m.n}</span>
                </div>`;
        }
    });
    
    container.innerHTML = menuHtml;
}

/* --- üñ±Ô∏è ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î (Accordion) --- */
function toggleBillingMenu() {
    const submenu = document.getElementById('billingSubmenu');
    const arrow = document.getElementById('billingArrow');
    
    // ‡∏™‡∏•‡∏±‡∏ö‡∏Ñ‡∏•‡∏≤‡∏™ open ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏•‡∏á‡∏°‡∏≤
    submenu.classList.toggle('open');
    // ‡∏´‡∏°‡∏∏‡∏ô‡∏•‡∏π‡∏Å‡∏®‡∏£
    arrow.classList.toggle('rotate');
}


        /* --- [4.3 DASHBOARD: ‡∏´‡∏ô‡πâ‡∏≤‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°] --- */

function renderDashboard(target) {

    if (!target) return;

    target.innerHTML = `

        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 font-black italic uppercase">

            <div class="glass-card border-l-8 border-[#C5A059] shadow-sm">

                <p class="text-[10px] text-gray-400 font-bold uppercase">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>

                <p class="text-3xl text-gray-800 mt-2 font-black italic">‡∏ø45,200</p>

            </div>

            <div class="glass-card border-l-8 border-[#D48197] shadow-sm">

                <p class="text-[10px] text-gray-400 font-bold uppercase">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</p>

                <p class="text-3xl text-gray-800 mt-2 font-black italic">3 ‡∏Ñ‡∏ô</p>

            </div>

            <div class="glass-card border-l-8 border-blue-400 shadow-sm">

                <p class="text-[10px] text-gray-400 font-bold uppercase">‡∏Ñ‡∏¥‡∏ß‡∏ô‡∏±‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>

                <p class="text-3xl text-gray-800 mt-2 font-black italic">12 ‡∏ô‡∏±‡∏î</p>

            </div>

            <div class="glass-card border-l-8 border-green-400 shadow-sm">

                <p class="text-[10px] text-gray-400 font-bold uppercase">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</p>

                <p class="text-3xl text-green-600 mt-2 font-black italic font-black">‡∏ø43,700</p>

            </div>

        </div>



        <div class="glass-card shadow-lg mb-8 border-t-4 border-blue-400">

            <h3 class="text-lg font-black ace-pink mb-6 uppercase italic">üìÖ ‡∏Ñ‡∏¥‡∏ß‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (12 ‡∏ô‡∏±‡∏î / <span class="text-red-500">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å 2</span>)</h3>

            <div class="overflow-x-auto">

                <table class="w-full text-left text-[11px] font-black italic uppercase">

                    <thead class="bg-slate-50 text-gray-500 border-b">

                        <tr>

                            <th class="p-3">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th class="p-3">HN</th><th class="p-3">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á</th>

                            <th class="p-3">‡πÄ‡∏ß‡∏•‡∏≤</th><th class="p-3">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th><th class="p-3">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>

                            <th class="p-3 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>

                        </tr>

                    </thead>

                    <tbody class="divide-y bg-white">

                        <tr>

                            <td class="p-3">1</td><td class="p-3">HN0001</td>

                            <td class="p-3"><span class="text-blue-600">üîµ FB</span></td>

                            <td class="p-3">10:00</td><td class="p-3">0971375498</td><td class="p-3">‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏£‡∏¥‡∏™‡∏≤ ‡∏£‡∏±‡∏Å‡∏™‡∏ß‡∏¢</td>

                            <td class="p-3 text-center"><span class="bg-green-100 text-green-600 px-3 py-1 rounded-full text-[9px]">üü¢ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span></td>

                        </tr>

                    </tbody>

                </table>

            </div>

        </div>



    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8 font-bold uppercase">
        
        <div class="glass-card shadow-lg border-t-4 border-[#C5A059] bg-white p-8">
            <h3 class="text-lg font-bold ace-pink mb-6 border-b-2 border-dashed pb-2 text-center">üí∞ ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (INCOMING)</h3>
            <div class="space-y-3 text-sm font-bold text-slate-600">
                <div class="flex justify-between border-b border-slate-50 pb-1"><span>üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</span><span class="text-slate-800">5,000.-</span></div>
                <div class="flex justify-between border-b border-slate-50 pb-1"><span>üì± ‡πÇ‡∏≠‡∏ô (QR)</span><span class="text-slate-800">15,200.-</span></div>
                <div class="flex justify-between border-b border-slate-50 pb-1"><span>üè¢ ‡πÇ‡∏≠‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</span><span class="text-slate-800">10,000.-</span></div>
                <div class="flex justify-between border-b border-slate-50 pb-1"><span>üí≥ ‡∏£‡∏π‡∏î‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</span><span class="text-slate-800">8,000.-</span></div>
                <div class="flex justify-between border-b border-slate-50 pb-1 text-slate-800"><span>üõçÔ∏è SHOPEE</span><span class="font-bold">2,500.-</span></div>
<div class="flex justify-between border-b border-slate-50 pb-1 text-slate-800"><span>üéüÔ∏è GOWABI</span><span class="font-bold">4,500.-</span></div>
                <div class="flex justify-between pt-3 text-xl ace-pink border-t-4 border-double font-bold mt-2">
                    <span>üìä ‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</span><span>45,200.-</span>
                </div>
            </div>
        </div>

        <div class="glass-card shadow-lg border-t-4 border-red-400 bg-slate-50/30 p-8">
            <h3 class="text-lg font-bold text-red-500 mb-6 border-b-2 border-dashed pb-2 text-center">üí∏ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (OUTGOING)</h3>
            <div class="space-y-4 mb-10 min-h-[120px]">
                <div class="p-4 bg-white rounded-2xl border-2 border-dashed border-red-100 flex justify-between items-center shadow-sm">
                    <div>
                        <p class="text-xs font-bold text-slate-600">üìâ ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î</p>
                        <p class="text-[9px] text-gray-400 font-bold">‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å: üè¢ ‡πÇ‡∏≠‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</p>
                    </div>
                    <span class="text-red-500 font-bold">- 500.-</span>
                </div>
            </div>

          
	<div class="gold-bg p-5 rounded-[2rem] text-white shadow-xl mt-6 border border-[#E4C580]/50">
    <div class="flex justify-between items-center px-2">
        <div>
            <p class="text-[10px] uppercase opacity-90 font-bold tracking-wider">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (NET)</p>
            <h2 class="text-3xl font-bold tracking-tighter">‡∏ø43,700.-</h2>
        </div>
        <div class="text-right border-l border-white/20 pl-4">
            <p class="text-[9px] opacity-80 font-bold">‡∏õ‡∏¥‡∏î‡∏¢‡∏≠‡∏î‡πÇ‡∏î‡∏¢: ADMIN</p>
            <p class="text-[10px] font-bold uppercase tracking-widest">ACE CLINIC</p>
        </div>
    </div>
</div>`;
}



     

/* ============================= */

/* ====== CUSTOMER LIST ======== */

/* ============================= */



let currentPageSize = 10;



/* --- ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ list (‡∏â‡∏ö‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏µ‡∏Å‡∏Å‡∏≤‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Login ‡πÑ‡∏î‡πâ) --- */
function renderCustomerList(target) {
    target.innerHTML = `
    <div class="glass-card mb-6 flex flex-wrap gap-4 items-center font-black italic uppercase">
        <select id="pageSize" class="border border-pink-100 px-4 py-2 rounded-xl text-xs">
            <option value="10">10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>
            <option value="25">25 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>
            <option value="50">50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>
        </select>
        <select id="branchFilter" class="border border-pink-100 px-4 py-2 rounded-xl text-xs">
            <option value="‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î">‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>
            <option value="‡∏™‡∏≤‡∏Ç‡∏≤‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ</option>
            <option value="‡∏™‡∏≤‡∏Ç‡∏≤‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ</option>
        </select>
        <input id="searchInput" type="text" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ / HN / ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" class="flex-1 border border-pink-100 px-5 py-2 rounded-xl text-xs outline-none">
        <button id="searchBtn" class="gold-bg text-white px-6 py-2 rounded-xl text-xs shadow-lg">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        <button onclick="openModalForAdd()" id="addCustomerBtn" class="bg-black text-white px-6 py-2 rounded-xl text-xs shadow-lg"> + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ </button>
    </div>

    <div class="glass-card shadow-2xl">
        <table class="w-full text-left text-xs">
            <thead class="bg-pink-50 border-b text-[#D48197]"><th class="p-1 text-center font-normal w-[40px]">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</th>
                <tr>
                    <th class="p-3">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th class="p-3">‡∏£‡∏π‡∏õ</th><th class="p-3">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠</th>
                    <th class="p-3">HN</th><th class="p-3">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th class="p-3">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</th>
                    <th class="p-3">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th><th class="p-3">‡∏™‡∏≤‡∏Ç‡∏≤</th><th class="p-3 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody id="customerTableBody"></tbody>
        </table>
    </div>`;

    // ===== ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ï‡∏≤‡∏¢: ‡∏õ‡∏¥‡∏î‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö Login ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ =====
    document.getElementById("pageSize").addEventListener("change", function(e){
        currentPageSize = parseInt(e.target.value);
        renderCustomerTable(customerDB);
    }); // <--- ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏õ‡∏¥‡∏î }); ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏∞!

    document.getElementById("searchBtn").addEventListener("click", applyCustomerFilter);
    
    renderCustomerTable(customerDB);
}


/* --- filter --- */

function applyCustomerFilter() {
    const keyword = document.getElementById("searchInput").value.toLowerCase();

    const branch = document.getElementById("branchFilter").value;

    let filtered = customerDB.filter(c => {

        const matchKeyword =

            c.fullname?.toLowerCase().includes(keyword) ||

            c.hn?.toLowerCase().includes(keyword) ||

            c.phone?.includes(keyword);



        const matchBranch =

            branch === "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" || c.branch === branch;



        return matchKeyword && matchBranch;

    });


    renderCustomerTable(filtered);

}

/* --- ‡∏•‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ --- */

function deleteCustomer(index) {



    if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")){

        customerDB.splice(index,1);

        localStorage.setItem("customerDB", JSON.stringify(customerDB));

        renderCustomerTable(customerDB);

    }

}


/* --- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ --- */

function editCustomer(index){

    openModalForEdit(index);

}


/* --- render ‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏â‡∏ö‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç + ‡∏™‡∏≤‡∏°‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏° Dropdown) --- */
function renderCustomerTable(data) {
    const tbody = document.getElementById("customerTableBody");
    if (!tbody) return;
    tbody.innerHTML = "";

    const limitedData = data.slice(0, currentPageSize);
    limitedData.forEach((c, index) => {
        const realIndex = customerDB.findIndex(item => item.hn === c.hn);
        tbody.innerHTML += `
            <tr class="border-b hover:bg-pink-50 transition">
                <td class="p-3 text-[10px]">${index + 1}</td>
                <td class="p-3">
                    <img src="${c.photo || 'https://via.placeholder.com/150'}" class="customer-photo shadow-sm">
                </td>
                <td class="p-3">${c.createdAt || '-'}</td>
                <td class="p-3 font-bold">${c.hn || '-'}</td>
                <td class="p-3">${c.fullname || '-'}</td>
                <td class="p-3">${c.nickname || '-'}</td>
                <td class="p-3">${c.phone || '-'}</td>
                <td class="p-3">${c.branch || '-'}</td>
                <td class="p-3 text-center min-w-[160px] relative">
                    <div class="inline-flex items-center bg-[#D48197] text-white rounded-full p-1 shadow-md relative">
                        <button onclick="openModalForEdit(${realIndex})" 
                                class="px-4 py-1 text-[11px] font-bold border-r border-white/30 hover:bg-white/10 rounded-l-full">
                            ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                        <button onclick="toggleActionMenu(event, ${index})" 
                                class="px-2 py-1 text-[11px] hover:bg-white/10 rounded-r-full transition-all">
                            ‚ñº
                        </button>
                        
                        <div id="action-menu-${index}" 
                             class="hidden absolute right-0 top-10 w-48 bg-white border border-pink-100 rounded-2xl shadow-2xl z-[999] overflow-hidden text-left font-black italic">
                            <button onclick="viewCustomerDetail(${realIndex})" class="w-full p-4 text-[11px] text-gray-600 hover:bg-pink-50 border-b flex items-center gap-2">
                                üëÅÔ∏è ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
                            </button>
                            <button onclick="printOPD(${realIndex})" class="w-full p-4 text-[11px] text-gray-600 hover:bg-pink-50 border-b flex items-center gap-2">
                                üìÑ ‡∏û‡∏¥‡∏°‡∏û‡πå OPD Card
                            </button>
                            <button class="w-full p-4 text-[11px] bg-gray-50 text-gray-400 cursor-not-allowed border-b flex items-center gap-2" disabled>
                                üö´ ‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à (‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)
                            </button>
                            <button onclick="deleteCustomer(${realIndex})" class="w-full p-4 text-[11px] text-red-500 hover:bg-red-50 flex items-center gap-2 font-bold">
                                üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ
                            </button>
                        </div>
                    </div>
                </td>
            </tr>`;
    });
}
      

        /* --- [4.5 PROFILE: ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤] --- */

        function showCustomerDetail(index) {

            const c = customerDB[index];

            const content = document.getElementById('dynamicContent');

            content.innerHTML = `

                <div class="glass-card mb-6 border-t-8 border-[#C5A059] animate-in slide-in-from-top duration-500 font-black italic uppercase">

                    <div class="flex flex-col md:flex-row justify-between items-center gap-8 font-black uppercase italic">

                        <div class="flex items-center gap-8">

                            <div class="w-32 h-32 rounded-[3rem] gold-bg flex items-center justify-center text-white text-5xl font-black shadow-2xl italic font-black">ACE</div>

                            <div><h2 class="text-4xl text-gray-800 tracking-tighter font-black italic uppercase">${c.fullname}</h2><p class="text-sm text-gray-400 mt-1 font-black italic uppercase">CODE: ${c.hn} | ‡∏™‡∏≤‡∏Ç‡∏≤: ${c.branch}</p></div>

                        </div>

                        <div class="flex gap-3 font-black uppercase italic">

                            <button class="gold-bg text-white px-8 py-4 rounded-[1.5rem] font-black text-xs shadow-xl italic font-black">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</button>

                            <div class="relative group"><button class="bg-white border-2 border-gray-100 px-8 py-4 rounded-[1.5rem] text-xs font-black shadow-sm group-hover:bg-gray-50 italic uppercase font-black">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‚ñº</button>

                                <div class="hidden group-hover:block absolute right-0 w-56 bg-white shadow-2xl rounded-2xl border border-pink-50 z-[200] overflow-hidden font-black italic"><button class="w-full text-left p-5 text-[11px] hover:bg-pink-50 border-b font-black italic uppercase">üìÑ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button></div>

                            </div>

                        </div>

                    </div>

                </div>

                <div class="flex gap-2 border-b border-pink-100 mb-8 overflow-x-auto font-black italic uppercase font-black italic font-black">

                    <div class="profile-tab active uppercase font-black italic font-black">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div><div class="profile-tab font-black italic font-black">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏±‡∏Å‡∏©‡∏≤</div><div class="profile-tab font-black italic font-black">‡∏Ñ‡∏≠‡∏£‡πå‡∏™ <span class="bg-red-500 text-white text-[9px] px-1.5 rounded-full ml-1 font-black italic font-black">1</span></div><div class="profile-tab font-black italic font-black">‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div><div class="profile-tab font-black italic font-black">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div><div class="profile-tab font-black italic font-black">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</div><div class="profile-tab font-black italic font-black">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</div>

                </div>

                <div class="glass-card font-black italic uppercase">

                    <h4 class="ace-pink uppercase mb-6 underline decoration-pink-100 text-lg font-black italic tracking-tighter uppercase font-black">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h4>

                    <p class="text-gray-800 uppercase italic font-black tracking-tighter">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ${c.phone}</p>

                    <p class="text-red-500 mt-2 italic font-black tracking-tighter underline">üö® ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏û‡πâ‡∏¢‡∏≤: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>

                </div>`;

}



/* --- [‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å 8 ‡πÅ‡∏ó‡πá‡∏ö] --- */

function showCustomerProfile(index) {

    const c = customerDB[index];

    const target = document.getElementById('dynamicContent');

    

    // 1Ô∏è‚É£ HEADER CARD: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏±‡∏ß‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏ô

    target.innerHTML = `

        <div class="glass-card mb-6 border-t-8 border-[#C5A059] animate-in slide-in-from-top duration-500 font-black italic uppercase">

            <div class="flex flex-col md:flex-row justify-between items-center gap-8 font-black uppercase italic">

                <div class="flex items-center gap-8">

                    <div class="w-32 h-32 rounded-[3rem] gold-bg flex items-center justify-center text-white text-5xl font-black shadow-2xl italic">ACE</div>

                    <div>

                        <h2 class="text-4xl text-gray-800 tracking-tighter font-black italic uppercase italic">${c.fullname}</h2>

                        <p class="text-sm text-[#C5A059] mt-1 font-black italic uppercase tracking-widest italic">CODE: ${c.hn} | ‡∏™‡∏≤‡∏Ç‡∏≤: ${c.branch}</p>

                        <div class="mt-4 flex gap-2">

                            <span class="bg-green-100 text-green-600 px-4 py-1 rounded-full text-[10px] font-black uppercase italic">‚óè ‡∏õ‡∏Å‡∏ï‡∏¥</span>

                            <span class="bg-purple-100 text-purple-600 px-4 py-1 rounded-full text-[10px] font-black uppercase italic">‡πÅ‡∏ú‡∏ô‡∏Å‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ô‡∏≠‡∏Å</span>

                        </div>

                    </div>

                </div>

                <div class="flex gap-3">

                    <button class="bg-[#337373] text-white px-8 py-4 rounded-[1.5rem] font-black text-xs shadow-xl italic font-black">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</button>

                    <button onclick="renderCustomerList(document.getElementById('dynamicContent'))" class="bg-white border-2 border-gray-100 px-8 py-4 rounded-[1.5rem] text-xs font-black shadow-sm italic uppercase font-black">üîô ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>

                </div>

            </div>

        </div>



        <div class="flex gap-1 border-b border-pink-100 mb-8 overflow-x-auto font-black italic uppercase italic">

            <div class="profile-tab active" onclick="switchTab(1)">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>

            <div class="profile-tab" onclick="switchTab(2)">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</div>

            <div class="profile-tab" onclick="switchTab(3)">‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>

            <div class="profile-tab" onclick="switchTab(4)">‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div>

            <div class="profile-tab" onclick="switchTab(5)">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô-‡∏´‡∏•‡∏±‡∏á</div>

            <div class="profile-tab" onclick="switchTab(6)">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ / ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö</div>

            <div class="profile-tab" onclick="switchTab(7)">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</div>

        </div>



        <div id="tabBody" class="glass-card font-black italic uppercase min-h-[350px]">

            <h4 class="ace-pink uppercase mb-6 underline decoration-pink-100 text-lg font-black italic tracking-tighter uppercase font-black italic">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h4>

            <div class="grid grid-cols-2 gap-8">

<div class="group">

<label class="text-[10px] text-gray-400 uppercase tracking-widest">

‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô

</label>

<input type="text" id="newNickname"

value="${c.nickname || ''}"

class="w-full border-b-2 ...">



</div>



                <div><p class="text-[10px] text-gray-400">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</p><p class="text-xl italic underline decoration-pink-200">${c.phone}</p></div>

                <div><p class="text-[10px] text-gray-400">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏™‡∏≤‡∏Ç‡∏≤</p><p class="text-xl ace-pink italic underline decoration-gold-200">${c.branch}</p></div>

                <div class="col-span-2 bg-red-50 p-6 rounded-[2.5rem] border border-red-100 shadow-sm mt-4">

                    <p class="text-red-500 font-black italic uppercase tracking-tighter italic">üö® ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡∏¢‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>

                </div>

            </div>

        </div>`;

}



function switchTab(id) {

    document.querySelectorAll('.profile-tab').forEach((t, i) => t.classList.toggle('active', i+1 === id));

    // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏Ñ‡πà‡∏∞

}

        



        /* --- [4.6 UTILITIES: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÜ] --- */

     function openModalForAdd(){



    editingIndex = null;



    clearModal();



    document.getElementById("modalTitle").innerText = "‚ú® ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏´‡∏°‡πà";



    generateHN(); // üëà ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ



    const modal = document.getElementById("customerModal");

    modal.classList.remove("hidden");

    modal.classList.add("flex");

}





/* ============================= */

/* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ */

/* ============================= */







/* ============================= */

/* Dropdown Control */

/* ============================= */



function toggleDropdown(index) {



    document.querySelectorAll("[id^='dropdown-']")

        .forEach(el => el.classList.add("hidden"));



    const menu = document.getElementById(`dropdown-${index}`);

    menu.classList.toggle("hidden");

}



document.addEventListener("click", function (e) {

    if (!e.target.closest(".relative")) {

        document.querySelectorAll("[id^='dropdown-']")

            .forEach(el => el.classList.add("hidden"));

    }

});



/* ============================= */

/* ‡∏•‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ */

/* ============================= */



function deleteCustomer(index) {

    if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {

        customerDB.splice(index, 1);

        renderCustomerTable(customerDB);

    }

}


/* =======================================================

   HEADER CONTROL (CLEAN VERSION - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ã‡πâ‡∏≥)

   ======================================================= */



// üïí ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤

function updateHeaderTime() {

    const timeEl = document.getElementById('headerLastUpdate');

    if (timeEl) {

        timeEl.innerText = new Date().toLocaleTimeString('th-TH', { hour12: false });

    }

}



// üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

window.refreshAllData = function() {



    updateHeaderTime();



    const currentPageTitle = document.getElementById('pageTitle').innerText;

    const targetContent = document.getElementById('dynamicContent');



    if (currentPageTitle === 'DASHBOARD' || currentPageTitle === 'DASHBOARD ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°') {

        renderDashboard(targetContent);

    } 

    else if (currentPageTitle === '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥') {

        renderCustomerList(targetContent);

    }



    console.log("ACE Clinic System: Updated at " + new Date().toLocaleTimeString());

};



// üìä ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤

window.changePeriod = function(period, btn) {



    document.querySelectorAll('.btn-period')

        .forEach(b => b.classList.remove('active'));



    btn.classList.add('active');



    refreshAllData();

};



// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤

window.addEventListener('DOMContentLoaded', () => {



    const dateInput = document.getElementById('headerDatePicker');

    if (dateInput) dateInput.valueAsDate = new Date();



    updateHeaderTime();

});



// ‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

setInterval(updateHeaderTime, 1000);



document.addEventListener("DOMContentLoaded", function(){

  const modal = document.getElementById("customerModal");

  if(modal){

    modal.classList.add("hidden");

    modal.classList.remove("flex");

  }

});

/* --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà 3 ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‡∏ï‡∏µ‡∏ö‡∏¥‡∏• --- */
function loadPage(id, title) {
    document.getElementById('pageTitle').innerText = title.toUpperCase();
    document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active-menu'));
    
    const activeMenu = document.getElementById(`menu-${id}`);
    if(activeMenu) activeMenu.classList.add('active-menu');
    
    const target = document.getElementById('dynamicContent');
    
    if(id === 1) {
        renderDashboard(target); // ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
    } 
    else if(id === 2) {
        renderCustomerList(target); // ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
    } 
    else if(id === 3) {
        renderSalesPage(); // üí∏ ‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡∏ó‡∏≠‡∏á)
    } 
	else if(id === 4) {
    renderAppointmentPage(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢
	}
	else if(id === 6) {
    renderAccountingReport(); // üìà ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡πà‡∏∞
	}
    else if(id === 9) {
        renderExpensePage(); // üí∏ ‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (‡∏™‡∏µ‡πÅ‡∏î‡∏á Luxury)
    }
    else {
        target.innerHTML = `<div class="glass-card text-center py-32 font-bold ace-pink uppercase text-2xl">‡πÄ‡∏°‡∏ô‡∏π ${title} <br> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤...</div>`;
    }
}

/* --- ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Login ‡πÅ‡∏•‡∏∞‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (‡∏ä‡∏∏‡∏î‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå) --- */

// 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
window.doLogin = function() {
    const u = document.getElementById('uIn').value;
    const p = document.getElementById('pIn').value;
    const user = users.find(x => x.email === u && x.pass === p);
    
    if (user) {
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('mainDashboard').classList.remove('hidden');
        document.getElementById('userNameLabel').innerText = `${user.name}`;
        renderMenuByRole(user.role);
        loadPage(1, 'Dashboard ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°');
    } else { 
        alert("‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ 1111 / 1111 ‡∏ô‡∏∞‡∏Ñ‡∏∞)"); 
    }
};


/* =======================================================
   üíé ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π ‡πÅ‡∏•‡∏∞ ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (View Detail / OPD)
   ======================================================= */

window.toggleActionMenu = function(event, index) {
    event.stopPropagation();
    const menuId = `action-menu-${index}`;
    document.querySelectorAll("[id^='action-menu-']").forEach(m => {
        if(m.id !== menuId) m.classList.add('hidden');
    });
    const currentMenu = document.getElementById(menuId);
    if(currentMenu) currentMenu.classList.toggle('hidden');
};

/* --- [‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏â‡∏ö‡∏±‡∏ö LUXURY - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏¥‡∏•‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á] --- */
window.viewCustomerDetail = function(index) {
    const c = customerDB[index];
    window.activeCustomer = c; 
    
    const target = document.getElementById('dynamicContent');
    let billHistoryDB = JSON.parse(localStorage.getItem('billHistoryDB')) || [];
    
    target.innerHTML = `
        <div class="bg-white rounded-[3rem] shadow-2xl p-10 animate-in zoom-in duration-300 border border-pink-50">
            <div class="flex justify-between items-center mb-10">
                <div class="flex items-center gap-4">
                    <h2 class="text-4xl font-black ace-pink italic">üë§ ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>
                    <span class="bg-purple-100 text-purple-600 px-4 py-1 rounded-full text-[10px] font-black italic uppercase">HN: ${c.hn}</span>
                    <button onclick="openBillingTab('${c.fullname}')" 
                        class="bg-slate-600 text-white px-5 py-2 rounded-xl text-[11px] font-black shadow-lg hover:bg-slate-700 transition-all uppercase">‡∏ï‡πà‡∏≠‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à / ‡∏ï‡∏µ‡∏ö‡∏¥‡∏•</button>
                </div>
                <button onclick="loadPage(2, '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥')" class="text-3xl text-gray-300 hover:text-red-400">‚úï</button>
            </div>

            <div class="flex flex-col lg:flex-row gap-10">
                <div class="w-full lg:w-80 space-y-6">
                    <div class="bg-white border border-pink-50 rounded-[2.5rem] p-8 shadow-sm text-center">
                        <div class="w-40 h-52 bg-pink-50 border-2 border-dashed border-pink-200 rounded-3xl mx-auto mb-6 flex items-center justify-center font-bold">
                            <span class="text-gray-300 font-black italic text-xs">ID PHOTO</span>
                        </div>
                        <h3 class="text-2xl font-black text-gray-700 italic">${c.fullname}</h3>
                        <p class="ace-pink font-black italic text-sm">@${c.nickname || '-'}</p>
                        <div class="mt-8 space-y-3 text-left text-[11px] font-black italic">
                            <div class="flex justify-between border-b pb-2"><span>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î:</span><span class="text-gray-700">19/08/1999</span></div>
                            <div class="flex justify-between border-b pb-2"><span>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</span><span class="ace-pink">${c.phone}</span></div>
                            <div class="flex justify-between border-b pb-2"><span>‡∏™‡∏≤‡∏Ç‡∏≤:</span><span class="text-green-500">${c.branch}</span></div>
                            <div class="flex justify-between text-red-500"><span>‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞:</span><span>‡∏ø0.00</span></div>
                        </div>
                    </div>
                </div>

                <div class="flex-1">
                    <div class="flex flex-wrap gap-2 mb-8">
                        <button onclick="switchProfileTab(1, ${index})" id="tab-1" class="profile-tab active px-6 py-2 rounded-2xl font-black italic text-xs transition-all">‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</button>
                        <button onclick="switchProfileTab(2, ${index})" id="tab-2" class="profile-tab bg-slate-50 text-slate-400 px-6 py-2 rounded-2xl font-black italic text-xs transition-all">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</button>
                        <button onclick="switchProfileTab(3, ${index})" id="tab-3" class="profile-tab bg-slate-50 text-slate-400 px-6 py-2 rounded-2xl font-black italic text-xs transition-all">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à/‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</button>
                        <button onclick="switchProfileTab(4, ${index})" id="tab-4" class="profile-tab bg-slate-50 text-slate-400 px-6 py-2 rounded-2xl font-black italic text-xs transition-all">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö</button>
                    </div>
                    <div id="profileTabBody" class="bg-white border border-pink-50 rounded-[3rem] p-0 min-h-[500px] shadow-sm relative overflow-hidden"></div>
                </div>
            </div>
        </div>`;
    switchProfileTab(1, index);
};

/* --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå (‡∏£‡∏ß‡∏° Tab 1, 3, 4 ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) --- */
window.switchProfileTab = function(tabId, customerIndex) {
    const body = document.getElementById('profileTabBody');
    const customer = customerDB[customerIndex]; 
    
    document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));
    document.getElementById(`tab-${tabId}`)?.classList.add('active');

    // üìä ‡πÅ‡∏ó‡πá‡∏ö 1: ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏£‡∏¥‡∏á
    if (tabId === 1) { 
        const courses = customer.courses || [];
        if (courses.length === 0) {
            body.innerHTML = `<div class="p-20 text-center animate-in fade-in"><p class="text-slate-300 font-normal">üìä ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p></div>`;
        } else {
            body.innerHTML = `
                <div class="p-4 animate-in fade-in space-y-3">
                    <div class="grid grid-cols-1 gap-2">
                        ${courses.map(c => `
                            <div class="bg-white border border-pink-100 p-1 rounded-2xl flex justify-between items-center shadow-sm">
                                <div>
                                    <p class="text-[8px] text-pink-400 font-normal uppercase mb-0.5">SERVICE COURSE</p>
                                    <p class="text-slate-700 font-normal text-base">${c.name}</p>
                                    <p class="text-[8px] text-slate-300 font-normal uppercase mt-0.5">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠: ${c.date}</p>
                                </div>
                                <div class="text-right bg-pink-50 px-4 py-1 rounded-xl border border-pink-50">
                                    <p class="text-[8px] text-pink-400 font-normal uppercase mb-0.5">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                                    <p class="text-xl font-normal ace-pink">${c.amount} <span class="text-[10px]">‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span></p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>`;
        }
    }
    // üßæ ‡πÅ‡∏ó‡πá‡∏ö 3: ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏ß‡∏á‡∏ï‡∏≤ üëÅÔ∏è)
    else if (tabId === 3) {
        const allBills = JSON.parse(localStorage.getItem('billHistoryDB')) || [];
        const myBills = allBills.filter(b => b.hn === customer.hn);
        
        if (myBills.length === 0) {
            body.innerHTML = `<div class="p-10 text-center text-slate-400 font-normal italic">üßæ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</div>`;
        } else {
            body.innerHTML = `
                <div class="p-1 animate-in fade-in">
                    <table class="w-full text-left font-normal text-[12px]">
                        <thead class="bg-pink-50/50 text-[#FF4B91] uppercase text-[11px] font-bold">
                            <tr>
                                <th class="p-1 pl-4 font-bold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th class="p-1 font-bold">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
                                <th class="p-1 font-bold">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á</th>
                                <th class="p-1 text-center w-[40px] font-bold">‡∏î‡∏π</th>
                            </tr>
                        </thead>
                        <tbody class="text-slate-600">
                            ${myBills.map((b, bIdx) => `
                                <tr class="border-b border-pink-50/30 hover:bg-pink-50/10 transition-all">
                                    <td class="p-0.5 pl-4 font-normal">${b.date}</td>
                                    <td class="p-0.5 font-normal">‡∏ø${parseFloat(b.total.replace(/[^0-9.-]+/g,"")).toLocaleString()}</td>
                                    <td class="p-0.5 text-[11px] font-normal">${b.payment}</td>
                                    <td class="p-0.5 text-center">
                                        <button onclick="openOldReceipt(${bIdx}, '${customer.hn}')" 
                                            class="bg-slate-50 p-0.5 rounded shadow-sm hover:bg-pink-100 transition-all scale-100">
                                            <span style="font-size: 10px;">üëÅÔ∏è</span>
                                        </button>
                                    </td>
                                </tr>`).join('')}
                        </tbody>
                    </table>
                </div>`;
        }
    }
    // üìÇ ‡πÅ‡∏ó‡πá‡∏ö 4: ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö (‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å OPD)
    else if (tabId === 4) {
        const treatments = customer.treatments || []; 
        if (treatments.length === 0) {
            body.innerHTML = `<div class="p-20 text-center italic text-slate-300">üìÇ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö</div>`;
        } else {
            body.innerHTML = `
                <div class="p-6 space-y-4">
                    <h4 class="text-sm font-bold text-slate-500 mb-4 uppercase tracking-widest">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</h4>
                    <div class="grid grid-cols-1 gap-3">
                        ${treatments.slice().reverse().map((t, idx) => `
                            <div class="bg-white border border-pink-100 p-4 rounded-2xl shadow-sm hover:border-[#FF4B91]/30 transition-all">
                                <span class="bg-pink-50 text-[#FF4B91] text-[10px] px-3 py-1 rounded-full font-bold uppercase">üìÖ ${t.date} | üïí ${t.time}</span>
                                <div class="bg-slate-50 p-4 rounded-xl mt-3 text-slate-700 text-sm whitespace-pre-line">${t.detail}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>`;
        }
    }
    // ‡∏Å‡∏£‡∏ì‡∏µ‡πÅ‡∏ó‡πá‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÜ
    else {
        body.innerHTML = `<div class="p-20 text-center text-slate-300 font-bold italic uppercase">‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤...</div>`;
    }
};

window.printOPD = function(index) {
    const c = customerDB[index];
    const target = document.getElementById('dynamicContent');
    
    window.autoFillCourse = function(courseName, amount, totalPrice) {
        const typeSelect = document.getElementById('opdTypeSelector');
        if (typeSelect.value !== 'skin_injection') {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó OPD ‡πÄ‡∏õ‡πá‡∏ô "‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏â‡∏µ‡∏î‡∏ú‡∏¥‡∏ß" ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞');
            return;
        }
        const tables = document.querySelectorAll('#opd-dynamic-layout table');
        let allCells = []; 
        tables.forEach(table => {
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => allCells.push(row.cells[2]));
        });
        let startIndex = allCells.findIndex(cell => cell.innerText === "");
        if (startIndex === -1) return;
        for (let i = 0; i < amount; i++) {
            if (allCells[startIndex + i]) {
                allCells[startIndex + i].innerText = `${courseName} ${i+1}/${amount}`;
            }
        }
    };

    const getAge = (dateString) => {
        if (!dateString) return "-";
        const today = new Date();
        const birth = new Date(dateString.split('/').reverse().join('-'));
        let age = today.getFullYear() - birth.getFullYear();
        if (today.getMonth() < birth.getMonth() || (today.getMonth() === birth.getMonth() && today.getDate() < birth.getDate())) age--;
        return age;
    };

    window.renderOPDByType = function(type) {
        const printableArea = document.getElementById('opd-dynamic-layout');
        let layoutHtml = '';

        if (type === 'skin_injection') {
            const row = (i) => `<tr class="border-b border-slate-300 h-7">
                <td class="p-1 text-center border-r font-bold bg-slate-50">${i}</td>
                <td class="p-1 border-r w-20"></td>
                <td class="p-1 border-r font-normal text-[9px] text-slate-700 text-left pl-2"></td>
                <td class="p-1 w-24"></td>
            </tr>`;
            layoutHtml = `
                <div class="mt-[1cm] animate-in fade-in">
                    <div class="text-center mb-1"><p class="text-[11px] font-bold ace-pink uppercase tracking-widest underline">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤ (‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏â‡∏µ‡∏î‡∏ú‡∏¥‡∏ß)</p></div>
                    <div class="grid grid-cols-2 gap-2">
                        <table class="w-full border border-slate-400 text-center">
                            <thead class="bg-slate-100 text-[9px]"><tr><th class="p-1 border-r w-8 font-bold">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà</th><th class="p-1 border-r font-bold w-20">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th class="p-1 border-r font-bold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™</th><th class="p-1 font-bold w-24">‡∏ú‡∏π‡πâ‡∏ó‡∏≥ / ‡πÄ‡∏ã‡πá‡∏ô</th></tr></thead>
                            <tbody>${[1,2,3,4,5,6,7].map(i => row(i)).join('')}</tbody>
                        </table>
                        <table class="w-full border border-slate-400 text-center">
                            <thead class="bg-slate-100 text-[9px]"><tr><th class="p-1 border-r w-8 font-bold">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà</th><th class="p-1 border-r font-bold w-20">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th class="p-1 border-r font-bold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™</th><th class="p-1 font-bold w-24">‡∏ú‡∏π‡πâ‡∏ó‡∏≥ / ‡πÄ‡∏ã‡πá‡∏ô</th></tr></thead>
                            <tbody>${[8,9,10,11,12,13,14].map(i => row(i)).join('')}</tbody>
                        </table>
                    </div>
                    <div class="mt-2 no-print">
                        <textarea id="treatmentNotesSkin" class="w-full h-12 border border-dotted border-slate-300 p-2 text-xs outline-none" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏ô‡∏µ‡πâ..."></textarea>
                    </div>
                    <div class="hidden print:block text-[10px] mt-2 italic border-t border-slate-100 pt-1" id="printNotesSkin"></div>
                </div>`;
        } else if (type === 'botox_filler' || type === 'varicose_veins') {
            layoutHtml = `
                <div class="mt-4 border border-slate-300 p-4 h-[440px] bg-white animate-in fade-in text-left">
                    <p class="text-[11px] font-bold ace-pink text-center mb-4 uppercase tracking-widest underline">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤ (${type === 'botox_filler' ? 'Botox/Filler' : '‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏Ç‡∏≠‡∏î'})</p>
                    <div class="flex h-full">
                        <div class="w-1/2 border-r border-dashed border-slate-300 pr-4"></div>
                        <div class="w-1/2 pl-4 text-[11px] space-y-3 font-normal">
                            <p><b>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</b> .....................................................</p>
                            <p><b>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠/Lot:</b> .....................................................</p>
                            <p><b>‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì (Unit/CC):</b> .....................................</p>
                            <div class="mt-4">
                                <p class="mb-1 font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</p>
                                <textarea id="treatmentNotesSpec" class="w-full h-40 border border-dotted border-slate-300 p-2 text-sm outline-none no-print" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
                                <div class="hidden print:block whitespace-pre-line text-sm border border-slate-50 p-2 min-h-[100px]" id="printNotesSpec"></div>
                            </div>
                        </div>
                    </div>
                </div>`;
        } else {
            layoutHtml = `
                <div class="mt-4 border border-slate-300 h-[440px] bg-slate-50/10 p-4 animate-in fade-in text-left">
                    <p class="text-[11px] font-bold ace-pink text-center mb-4 uppercase tracking-widest underline">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</p>
                    <textarea id="treatmentNotesGeneral" class="w-full h-80 bg-transparent border-none outline-none no-print text-sm" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
                    <div class="hidden print:block whitespace-pre-line text-sm" id="printNotesGeneral"></div>
                </div>`;
        }
        printableArea.innerHTML = layoutHtml;
    };

    target.innerHTML = `
        <div class="max-w-4xl mx-auto p-4 font-normal text-slate-800 bg-slate-100 min-h-screen">
            <div class="no-print mb-4 space-y-2 text-left">
                <div class="bg-white p-3 rounded-2xl shadow-sm border border-pink-100">
                    <p class="text-[10px] font-bold text-pink-500 mb-2 uppercase tracking-widest">üõí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á :</p>
                    <div class="flex flex-wrap gap-2">
                        ${(c.courses || []).map(course => {
                            const p = parseFloat(String(course.price).replace(/[^0-9.-]+/g,"")) || 0;
                            return `<button onclick="autoFillCourse('${course.name}', ${course.amount}, ${p})" class="bg-pink-50 hover:bg-pink-500 hover:text-white border border-pink-200 px-4 py-2 rounded-xl text-[11px] font-bold transition-all shadow-sm">‚ûï ${course.name}</button>`;
                        }).join('')}
                    </div>
                </div>
                <div class="bg-[#337373] p-3 rounded-2xl shadow-sm flex items-center justify-between text-white">
                    <div class="flex items-center gap-4">
                        <label class="text-xs font-bold uppercase">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó OPD :</label>
                        <select id="opdTypeSelector" onchange="renderOPDByType(this.value)" class="bg-white text-[#337373] px-5 py-2 rounded-xl text-xs font-bold outline-none">
                            <option value="general">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                            <option value="botox_filler">üíâ Botox / Filler</option>
                            <option value="skin_injection">‚ú® ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏â‡∏µ‡∏î‡∏ú‡∏¥‡∏ß (‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≠‡πÇ‡∏ï‡πâ)</option>
                            <option value="varicose_veins">ü¶µ ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏Ç‡∏≠‡∏î</option>
                        </select>
                    </div>
                    <button onclick="renderOPDByType(document.getElementById('opdTypeSelector').value)" class="text-[10px] bg-[#2a5e5e] hover:bg-[#1f4747] px-4 py-2 rounded-xl transition-all font-bold">üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á / ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </div>

            <div id="opd-card-printable" class="bg-white p-6 shadow-sm border border-slate-200 mx-auto" style="width: 21cm; height: 14.8cm; line-height: 1.1; overflow: hidden;">
                <div class="flex justify-between items-start mb-2 text-left">
                    <div class="flex gap-2">
                        <img src="ace-logo.jpg" class="w-12 h-12 object-contain" onerror="this.src='https://via.placeholder.com/50?text=ACE'">
                        <div class="text-[10px] font-normal">
                            <h2 class="text-sm font-bold text-slate-900">‡πÄ‡∏≠‡∏ã ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡πÄ‡∏ß‡∏ä‡∏Å‡∏£‡∏£‡∏° ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ</h2>
                            <p>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï : ‡πë‡πë‡πë‡πê‡πë‡πê‡πê‡πï‡πë‡πñ‡πñ | ‡πÇ‡∏ó‡∏£ : 097-0942875</p>
                            <p>456/7 ‡∏´‡∏°‡∏π‡πà 10 ‡∏ï.‡∏ö‡∏≤‡∏á‡∏õ‡∏•‡∏≤ ‡∏≠.‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ ‡∏à.‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£ 10540</p>
                        </div>
                    </div>
                    <div class="text-right text-[10px] font-normal">
                        <p class="text-sm font-bold">HN : <span class="ace-pink">${c.hn}</span></p>
                        <p class="text-red-600 font-bold uppercase">‡πÅ‡∏û‡πâ‡∏¢‡∏≤ : <span class="font-normal underline text-slate-900">${c.allergy || '‡πÑ‡∏°‡πà‡∏°‡∏µ'}</span></p>
                        <p>‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß : <span class="font-normal">${c.chronicDisease || '-'}</span></p>
                        <p>‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥ : <span class="font-normal">${c.currentMedication || '-'}</span></p>
                    </div>
                </div>

                <div class="grid grid-cols-4 gap-y-0.5 text-[10px] mb-2 pb-2 border-y border-slate-200 pt-1 font-normal text-left">
                    <div class="col-span-2"><b>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• :</b> ${c.fullname}</div>
                    <div><b>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô :</b> ${c.nickname || '-'}</div>
                    <div><b>‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î :</b> ${c.birthDate || '-'}</div>
                    <div><b>‡∏≠‡∏≤‡∏¢‡∏∏ :</b> ${getAge(c.birthDate)} ‡∏õ‡∏µ</div>
                    <div class="col-span-3"><b>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ :</b> ${c.phone}</div>
                    <div class="col-span-2"><b>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ç‡∏≤‡∏ï‡∏¥‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô :</b> ${c.emergencyContact || '-'}</div>
                    <div class="col-span-2"><b>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà :</b> ${c.address || '-'}</div>
                </div>

                <div id="opd-dynamic-layout"></div>
            </div>

            <div class="flex justify-between items-center no-print mt-6 px-4">
                <button onclick="loadPage(2, '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤')" class="text-slate-400 font-bold text-xs uppercase">üîô ‡∏Å‡∏•‡∏±‡∏ö</button>
                <div class="flex gap-3">
                    <button onclick="saveTreatmentHistory(${index})" class="bg-slate-700 text-white px-8 py-3 rounded-2xl font-bold text-xs shadow-md">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button onclick="handleOPDPrint()" class="bg-[#D4AF37] text-white px-10 py-3 rounded-2xl font-bold text-xs shadow-xl">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</button>
                </div>
            </div>
        </div>
    `;
    renderOPDByType('general'); 
};

window.handleOPDPrint = function() {
    const type = document.getElementById('opdTypeSelector').value;
    if (type === 'general') {
        const notes = document.getElementById('treatmentNotesGeneral');
        document.getElementById('printNotesGeneral').innerText = notes ? notes.value : '';
    } else if (type === 'botox_filler' || type === 'varicose_veins') {
        const notes = document.getElementById('treatmentNotesSpec');
        document.getElementById('printNotesSpec').innerText = notes ? notes.value : '';
    } else if (type === 'skin_injection') {
        const notes = document.getElementById('treatmentNotesSkin');
        document.getElementById('printNotesSkin').innerText = notes ? notes.value : '';
    }
    window.print();
};
document.addEventListener('click', () => {
    document.querySelectorAll("[id^='action-menu-']").forEach(m => m.classList.add('hidden'));
});

/* =======================================================
   ‡∏´‡∏ô‡πâ‡∏≤ 3 üí∏ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ / ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏• (Luxury Clean Edition)
   ======================================================= */
window.renderSalesPage = function() {
    const target = document.getElementById('dynamicContent');
    currentBillItems = []; 

    target.innerHTML = `
        <div class="animate-in fade-in duration-500 p-8 bg-white min-h-screen font-bold">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h4 class="text-3xl text-[#FF4B91] font-bold">üßæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ / ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•</h4>
                    <p class="text-slate-400 text-[11px] mt-2 font-bold uppercase">‡∏•‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô (INCOMING)</p>
                </div>
                <div class="flex gap-4">
                    <div class="w-44 text-left">
                        <label class="text-[10px] text-slate-400 uppercase font-bold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏µ‡∏ö‡∏¥‡∏•</label>
                        <input type="date" id="billDate" 
                            class="w-full bg-slate-50 border border-pink-100 rounded-xl p-3 text-sm outline-none font-bold text-slate-600">
                    </div>
                    <button onclick="loadPage(1, 'Dashboard ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°')" 
                        class="bg-pink-50 text-[#FF4B91] px-6 py-2 rounded-2xl text-xs hover:bg-[#FF4B91] hover:text-white transition-all font-bold">
                        ‚úï ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>

            <div class="bg-[#FFF0F5] rounded-[2.5rem] p-8 mb-8 border-2 border-dashed border-[#FF4B91]/30">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-5 items-end">
                    
                   <div class="lg:col-span-3 space-y-2 text-left relative" style="z-index: 9999;">
    <label class="text-xs text-[#FF4B91] font-bold ml-1">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / HN</label>
    <input type="text" id="customerSearchInput" 
        oninput="searchCustomerForBill(this.value)" 
        placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤..." 
        class="w-full bg-white border border-pink-200 rounded-2xl p-4 text-sm text-slate-700 outline-none shadow-sm font-bold focus:border-[#FF4B91]">
    
    <div id="customerSearchResult" 
        class="absolute left-0 w-full bg-white shadow-2xl rounded-xl mt-1 hidden border border-pink-100 overflow-hidden" 
        style="z-index: 10000;">
    </div>
</div>

                    <div class="lg:col-span-4 space-y-2 text-left relative z-[1000]">
                        <label class="text-xs text-[#FF4B91] font-bold ml-1">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏£‡πå‡∏™ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏¢‡∏≤</label>
                        <input type="text" id="itemName" oninput="searchProduct(this.value)" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£..." 
                            class="w-full bg-white border border-pink-200 rounded-2xl p-4 text-sm text-slate-700 outline-none shadow-sm font-bold focus:border-[#FF4B91]">
                        <div id="searchResult" class="absolute left-0 w-full bg-white shadow-xl rounded-2xl mt-1 hidden max-h-48 overflow-y-auto border border-pink-100"></div>
                    </div>

                    <div class="lg:col-span-2 space-y-2 text-left">
                        <label class="text-xs text-[#FF4B91] font-bold ml-1">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ø)</label>
                        <input type="number" id="billPrice" placeholder="0.00" 
                            class="w-full bg-white border border-pink-200 rounded-2xl p-4 text-sm text-[#FF4B91] outline-none shadow-sm font-bold [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none">
                    </div>

                    <div class="lg:col-span-1 space-y-2 text-left">
                        <label class="text-xs text-[#FF4B91] font-bold ml-1 text-center block">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
                        <input type="number" id="billQty" value="1" min="1"
                            class="w-full bg-white border border-pink-200 rounded-2xl p-4 text-sm text-[#FF4B91] outline-none shadow-sm text-center font-bold [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none">
                    </div>

                    <div class="lg:col-span-2">
                        <button onclick="addItemToBill()" class="w-full bg-[#FF4B91] text-white py-4 rounded-2xl text-[11px] hover:bg-[#E63980] transition-all shadow-lg font-bold uppercase tracking-wider">
                            + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        </button>
                    </div>
                </div>
            </div>

            <div class="mb-8 overflow-hidden rounded-[1.5rem] border border-pink-50 shadow-sm">
                <table class="w-full text-left font-bold">
                    <thead class="bg-[#FFF0F5] text-[11px] text-[#FF4B91] uppercase tracking-wider">
                        <tr>
                            <th class="p-4">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                            <th class="p-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ / ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th class="p-4 text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                            <th class="p-4 text-right">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                            <th class="p-4 text-right">‡∏£‡∏ß‡∏° (‡∏ø)</th>
                            <th class="p-4 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="billItemsList" class="text-[13px] text-slate-600 font-bold">
                        <tr><td colspan="6" class="p-8 text-center text-slate-300">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 border-t border-pink-50 pt-8">
                <div class="space-y-4 text-left">
                    <p class="text-xs text-slate-400 font-bold uppercase ml-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</p>
                    
<div class="space-y-4 text-left">
    <select id="billPaymentMethod" 
        onchange="window.selectedPaymentMethod = this.value"
        class="w-full bg-[#FFF0F5] border border-pink-100 rounded-2xl p-4 text-sm text-slate-700 outline-none font-bold focus:border-[#FF4B91] appearance-none cursor-pointer">
        <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á --</option>
        <option value="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î">üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</option>
        <option value="‡πÇ‡∏≠‡∏ô (QR)">üì± ‡πÇ‡∏≠‡∏ô (QR)</option>
        <option value="‡πÇ‡∏≠‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó">üè¢ ‡πÇ‡∏≠‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</option>
        <option value="‡∏£‡∏π‡∏î‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï">üí≥ ‡∏£‡∏π‡∏î‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</option>
        <option value="Shopee">üõçÔ∏è Shopee</option>
        <option value="Gowabi">üéüÔ∏è GOWABI</option>
    </select>
</div>
                </div>
                
                <div class="text-right flex flex-col justify-end items-end">
                    <p class="text-xs text-slate-400 font-bold">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞ (GRAND TOTAL)</p>
                    <h5 id="grandTotalDisplay" class="text-6xl text-[#FF4B91] font-bold">‡∏ø0.00</h5>
                    <button onclick="confirmFinalPayment()" 
                        class="mt-6 bg-[#D4AF37] text-white px-16 py-4 rounded-2xl text-sm shadow-xl hover:bg-[#C5A028] transition-all font-bold">
                        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à
                    </button>
                </div>
            </div>
        </div>
    `;
   
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    document.getElementById('billDate').valueAsDate = new Date();
};

/* --- üîç ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ --- */
window.searchCustomerForBill = function(val) {
    const resDiv = document.getElementById('customerSearchResult');
    if (!val) { resDiv.classList.add('hidden'); return; }
    
    // üéØ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÑ‡∏´‡∏ô (customerDB ‡∏´‡∏£‡∏∑‡∏≠ customerData)
    const db = (typeof customerDB !== 'undefined') ? customerDB : (typeof customerData !== 'undefined' ? customerData : []);
    
    // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏î‡∏¢‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ (fullname/name) ‡πÅ‡∏•‡∏∞ HN
    const matches = db.filter(c => 
        (c.fullname && c.fullname.includes(val)) || 
        (c.name && c.name.includes(val)) || 
        (c.hn && c.hn.includes(val))
    );
    
    if (matches.length > 0) {
        resDiv.innerHTML = matches.map(c => {
            const displayName = c.fullname || c.name; // ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå
            return `
                <div onclick="window.selectCustomerForBill('${displayName}', '${c.hn}')" 
                    class="p-4 hover:bg-pink-50 cursor-pointer border-b border-pink-50 flex justify-between items-center font-bold bg-white text-left">
                    <span class="text-sm text-slate-700 pointer-events-none">${displayName}</span>
                    <span class="text-[10px] bg-slate-100 px-2 py-1 rounded-full uppercase pointer-events-none text-slate-500">${c.hn}</span>
                </div>
            `;
        }).join('');
        resDiv.classList.remove('hidden');
    } else {
        resDiv.classList.add('hidden');
    }
};

window.selectCustomerForBill = function(name, hn) {
    const input = document.getElementById('customerSearchInput');
    const display = document.getElementById('selectedCustomerDisplay');
    const resDiv = document.getElementById('customerSearchResult');

    if (input) {
        input.value = name; // ‡∏ô‡∏≥‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
    }
    
    if (display) {
        display.innerText = `‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${name} (${hn})`;
        display.style.color = "#FF4B91"; // ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡∏™‡∏î‡πÉ‡∏™‡∏ï‡∏≤‡∏°‡∏ò‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà
        display.classList.remove('italic');
    }
    
    resDiv.classList.add('hidden'); // ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
};

/* --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏¥‡∏• (‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏£‡∏á 100%) --- */
function renderBillItems() {
    const listBody = document.getElementById('billItemsList');
    let grandTotal = 0;

    if (currentBillItems.length === 0) {
        listBody.innerHTML = `<tr><td colspan="6" class="p-8 text-center text-slate-300 font-bold">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</td></tr>`;
    } else {
        listBody.innerHTML = currentBillItems.map((item, index) => {
            grandTotal += item.total;
            return `
                <tr class="border-b border-pink-50 hover:bg-pink-50/20 transition-all font-bold">
                    <td class="p-4"><span class="bg-slate-100 px-2 py-1 rounded-lg text-[10px] uppercase">${item.cat === 'medicine' ? '‡∏¢‡∏≤/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤' : '‡∏Ñ‡∏≠‡∏£‡πå‡∏™'}</span></td>
                    <td class="p-4 text-slate-700">${item.name}</td>
                    <td class="p-4 text-center text-slate-600">${item.qty}</td>
                    <td class="p-4 text-right text-slate-600">‡∏ø${item.price.toLocaleString()}</td>
                    <td class="p-4 text-right ace-pink">‡∏ø${item.total.toLocaleString()}</td>
                    <td class="p-4 text-center">
                        <button onclick="removeItemFromBill(${index})" class="text-red-300 hover:text-red-500 transition-all">‚úï</button>
                    </td>
                </tr>
            `;
        }).join('');
    }
    document.getElementById('grandTotalDisplay').innerText = '‡∏ø' + grandTotal.toLocaleString();
}

    /* --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô --- */
let selectedPaymentMethod = ""; 

window.selectPaymentType = function(btn, type) {
    document.querySelectorAll('#paymentMethods button').forEach(b => {
        b.classList.remove('border-pink-500', 'text-pink-500', 'bg-pink-50');
    });
    btn.classList.add('border-pink-500', 'text-pink-500', 'bg-pink-50');
    selectedPaymentMethod = type; // ‡πÄ‡∏Å‡πá‡∏ö‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
};

/* --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏õ‡∏•‡∏¥‡πâ‡∏ô‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à --- */
window.confirmFinalPayment = function() {
    try {
        const paymentSelect = document.getElementById('billPaymentMethod');
        const paymentValue = paymentSelect ? paymentSelect.value : "";
        const dateInput = document.getElementById('billDate');
        const billDate = dateInput ? dateInput.value : new Date().toLocaleDateString('th-TH');
        const total = document.getElementById('grandTotalDisplay').innerText;

        let customerHN = (window.activeCustomer) ? window.activeCustomer.hn : "HN-GENERAL";
        let customerName = (window.activeCustomer) ? (window.activeCustomer.fullname || window.activeCustomer.name) : (document.getElementById('customerSearchInput')?.value || "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ");

        if (currentBillItems.length === 0 || !paymentValue) {
            alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏∞');
            return;
        }

        // üéØ ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
        if (window.activeCustomer) {
            if (!window.activeCustomer.courses) window.activeCustomer.courses = [];
            currentBillItems.forEach(item => {
                window.activeCustomer.courses.push({
                    name: item.name,
                    amount: item.qty || 1,
                    date: billDate
                });
            });
      	     const idx = customerDB.findIndex(c => c.hn === window.activeCustomer.hn);
		if (idx !== -1) {
   		 customerDB[idx] = window.activeCustomer;
  		  // üéØ ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢‡∏ï‡∏≠‡∏ô‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ñ‡πà‡∏∞
   		 localStorage.setItem('customerDB', JSON.stringify(customerDB)); 
		}
      	  }

        const newBill = {
            hn: customerHN,
            date: billDate,
            customer: customerName,
            items: [...currentBillItems],
            total: total,
            payment: paymentValue,
            timestamp: new Date().getTime()
        };

        let billHistoryDB = JSON.parse(localStorage.getItem('billHistoryDB')) || [];
        billHistoryDB.push(newBill);
        localStorage.setItem('billHistoryDB', JSON.stringify(billHistoryDB));
        window.billHistoryDB = billHistoryDB;

        alert(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞`);
        showReceiptPreview(newBill);
    } catch (e) { alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + e.message); }
};

/* --- ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (‡∏™‡∏µ‡πÅ‡∏î‡∏á Luxury) --- */
window.renderExpensePage = function() {
    const target = document.getElementById('dynamicContent');
    target.innerHTML = `
        <div class="animate-in fade-in duration-500 p-8 bg-white min-h-screen font-bold">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h4 class="text-3xl text-red-500 font-bold">üí∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (OUTGOING)</h4>
                    <p class="text-slate-400 text-[11px] mt-2 font-bold uppercase">‡∏•‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (‡∏´‡∏±‡∏Å‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢)</p>
                </div>
                <div class="flex gap-4">
                    <div class="w-44 text-left">
                        <label class="text-[10px] text-slate-400 uppercase font-bold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label>
                        <input type="date" id="expenseDate" class="w-full bg-slate-50 border border-red-100 rounded-xl p-3 text-sm outline-none font-bold">
                    </div>
                    <button onclick="loadPage(1, 'Dashboard ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°')" class="bg-red-50 text-red-500 px-6 py-2 rounded-2xl text-xs hover:bg-red-500 hover:text-white transition-all font-bold">‚úï ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
                </div>
            </div>

            <div class="bg-red-50/40 rounded-[2.5rem] p-8 mb-8 border-2 border-dashed border-red-200">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-5 items-end">
                    <div class="lg:col-span-5 space-y-2 text-left">
                        <label class="text-sm text-red-500 font-bold ml-1">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</label>
                        <input type="text" id="expenseName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î, ‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå..." 
                            class="w-full bg-white border border-red-100 rounded-2xl p-4 text-sm text-slate-700 outline-none shadow-sm font-bold">
                    </div>
                    <div class="lg:col-span-3 space-y-2 text-left">
    <label class="text-sm text-red-500 font-bold ml-1">‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
    <select id="expenseAccount" class="w-full bg-white border border-red-100 rounded-2xl p-4 text-sm text-slate-600 outline-none font-bold cursor-pointer">
        <option value="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î">üíµ ‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å: ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</option>
        <option value="‡πÇ‡∏≠‡∏ô (QR)">üì± ‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å: ‡πÇ‡∏≠‡∏ô (QR)</option>
        <option value="‡πÇ‡∏≠‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó">üè¢ ‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å: ‡πÇ‡∏≠‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</option>
        <option value="‡∏£‡∏π‡∏î‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï">üí≥ ‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å: ‡∏£‡∏π‡∏î‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</option>
        <option value="Shopee">üõçÔ∏è ‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å: Shopee</option>
        <option value="Gowabi">üéüÔ∏è ‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å: Gowabi</option>
    </select>
</div>
                    <div class="lg:col-span-2 space-y-2 text-left">
                        <label class="text-sm text-red-500 font-bold ml-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ø)</label>
                        <input type="number" id="expenseAmount" placeholder="0.00" 
                            class="w-full bg-white border border-red-100 rounded-2xl p-4 text-sm text-red-600 outline-none shadow-sm font-bold [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none">
                    </div>
                    <div class="lg:col-span-2">
                        <button onclick="alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!')" class="w-full bg-red-500 text-white py-4 rounded-2xl text-[11px] hover:bg-red-600 transition-all shadow-lg font-bold uppercase tracking-wider">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-20 text-center text-slate-300 font-bold border-2 border-dashed border-slate-50 rounded-[2.5rem]">
                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏£‡∏≠‡∏∏‡∏°‡∏≤...
            </div>
        </div>
    `;
    document.getElementById('expenseDate').valueAsDate = new Date(); // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
};

/* =======================================================
   üíé ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©: ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à / ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ / ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ
   ======================================================= */

// 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå
window.showReceiptPreview = function(billData) {
    const target = document.getElementById('dynamicContent');
    target.innerHTML = `
        <div class="animate-in zoom-in duration-300 flex flex-col items-center p-10 bg-slate-50 min-h-screen font-bold">
            <div id="printableReceipt" class="bg-white w-[500px] p-10 shadow-2xl border border-pink-100 rounded-sm text-slate-800">
                <div class="text-center border-b-2 border-[#FF4B91] pb-6 mb-6">
                    <h2 class="text-2xl text-[#FF4B91] font-black uppercase tracking-tighter">ACE CLINIC RECEIPT</h2>
                    <p class="text-[10px] text-slate-400 mt-1 uppercase font-bold">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡πà‡∏≠ (INCOMING)</p>
                </div>
                <div class="flex justify-between text-[11px] mb-6">
                    <div><p>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${billData.customer}</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${billData.date}</p></div>
                    <div class="text-right uppercase"><p>INV-${Date.now().toString().slice(-6)}</p><p>‡∏™‡∏≤‡∏Ç‡∏≤: ‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ</p></div>
                </div>
                <table class="w-full text-[11px] mb-8">
                    <thead class="border-b border-slate-100"><tr><th class="py-2 text-left">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th class="py-2 text-right">‡∏£‡∏ß‡∏° (‡∏ø)</th></tr></thead>
                    <tbody>
                        ${currentBillItems.map(item => `
                            <tr class="border-b border-slate-50">
                                <td class="py-3">${item.name} x ${item.qty}</td>
                                <td class="py-3 text-right">${item.total.toLocaleString()}</td>
                            </tr>`).join('')}
                    </tbody>
                </table>
                <div class="text-right space-y-1 mb-10">
                    <p class="text-lg">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: <span class="text-[#FF4B91] text-2xl font-black">‡∏ø${billData.total}</span></p>
                    <p class="text-[10px] text-slate-400 font-bold">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á: ${billData.payment}</p>
                </div>
            </div>
            <div class="flex gap-4 mt-10 no-print">
    <button onclick="window.print()" class="bg-[#FF4B91] text-white px-10 py-3 rounded-2xl font-bold shadow-xl">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</button>
    
    <button onclick="backToCustomerProfile()" 
        class="bg-white border border-slate-200 px-10 py-3 rounded-2xl font-bold text-slate-400 hover:bg-slate-50 transition-all">
        üîô ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
    </button>
</div>
        </div>`;
};

// 2. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ‡πÇ‡∏ä‡∏ß‡πå‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏µ‡πÅ‡∏î‡∏á)
window.renderExpenseTable = function() {
    const listArea = document.getElementById('expenseListTable');
    if (!listArea) return;
    listArea.innerHTML = `
        <div class="overflow-hidden rounded-[1.5rem] border border-red-50 shadow-sm mt-8 animate-in fade-in">
            <table class="w-full text-left font-bold">
                <thead class="bg-red-50 text-[11px] text-red-500 uppercase">
                    <tr><th class="p-4">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th class="p-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th class="p-4 text-center">‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</th><th class="p-4 text-right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ø)</th></tr>
                </thead>
                <tbody class="text-[13px] text-slate-600 font-bold" id="expenseDataBody">
                    <tr><td colspan="4" class="p-10 text-center text-slate-300">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ...</td></tr>
                </tbody>
            </table>
        </div>`;
};

// 3. ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
window.renderAccountingReport = function() {
    const target = document.getElementById('dynamicContent');
    target.innerHTML = `
        <div class="animate-in fade-in duration-500 p-8 bg-white min-h-screen font-bold">
            <h4 class="text-3xl text-[#FF4B91] font-bold mb-8">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (ACCOUNTING)</h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                ${['‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î', '‡πÇ‡∏≠‡∏ô (QR)', '‡πÇ‡∏≠‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó', '‡∏£‡∏π‡∏î‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï', 'Shopee', 'Gowabi'].map(acc => `
                    <div class="bg-[#FFF0F5] p-6 rounded-[2rem] border border-pink-100 shadow-sm">
                        <p class="text-[10px] text-slate-400 uppercase font-bold tracking-widest">${acc}</p>
                        <p class="text-3xl text-slate-700 font-black mt-2">‡∏ø0.00</p>
                    </div>`).join('')}
            </div>
            <div class="mt-8 p-10 bg-[#FF4B91] rounded-[2.5rem] text-white flex justify-between items-center shadow-2xl">
                <div><p class="text-sm opacity-80 font-bold uppercase">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p><h2 class="text-6xl font-black italic tracking-tighter font-bold">‡∏ø45,200</h2></div>
                <button onclick="window.print()" class="bg-white text-[#FF4B91] px-10 py-4 rounded-2xl font-bold text-sm uppercase">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</button>
            </div>
        </div>`;
};

window.viewReceiptDetail = function(billData) {
    if (typeof showReceiptPreview === 'function') {
        showReceiptPreview(billData);
    } else {
        alert("‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡∏¥‡∏•: " + billData.customer + "\n‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: " + billData.total);
    }
};
/* --- üîô ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô --- */
window.backToCustomerProfile = function() {
    if (window.activeCustomer) {
        // üéØ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å DB ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        const idx = customerDB.findIndex(c => c.hn === window.activeCustomer.hn);
        if (idx !== -1) {
            viewCustomerDetail(idx);
            document.getElementById('pageTitle').innerText = "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥";
        } else {
            loadPage(2, '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥');
        }
    } else {
        loadPage(2, '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥');
    }
};

/* --- üëÅÔ∏è ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏ö‡∏¥‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå (‡∏â‡∏ö‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡πâ‡∏≤‡∏á) --- */
window.openOldReceipt = function(index, hn) {
    try {
        // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏¥‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥
        const allBills = JSON.parse(localStorage.getItem('billHistoryDB')) || [];
        
        // 2. ‡∏Å‡∏£‡∏≠‡∏á‡∏´‡∏≤‡∏ö‡∏¥‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ HN ‡∏ô‡∏µ‡πâ
        const myBills = allBills.filter(b => b.hn === hn);
        
        // 3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏¥‡∏•‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Å‡∏î (Index)
        const selectedBill = myBills[index];
        
        if (selectedBill) {
            // üéØ ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤ (selectedBill.items) 
            // ‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤/‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÇ‡∏ä‡∏ß‡πå‡∏Ñ‡πà‡∏∞
            window.currentBillItems = selectedBill.items || [];
            
            // 4. ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à
            showReceiptPreview(selectedBill);
            
            // 5. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏î‡∏π Luxury
            document.getElementById('pageTitle').innerText = "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á";
        } else {
            alert("‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡πà‡∏∞ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡πÉ‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö");
        }
    } catch (e) {
        console.error("Error opening old receipt:", e);
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏¥‡∏•‡∏Ñ‡πà‡∏∞");
    }
};

/* =======================================================
    üéØ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ (APPOINTMENT SYSTEM LUXURY) - [‡∏ä‡∏∏‡∏î‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î]
   ======================================================= */

let selectedCoursesForApp = []; 
let currentAppPage = 1; 
let appRowsPerPage = 10; 

window.renderAppointmentPage = function() {
    const target = document.getElementById('dynamicContent');
    if (!target) return;
    const appointments = JSON.parse(localStorage.getItem('appointmentDB')) || [];
    
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
    const today = new Date().toISOString().split('T')[0];
    const dateFilter = document.getElementById('filterDate')?.value || today;
    const currentSearch = document.getElementById('appSearchInput')?.value || "";
    const statusFilter = document.getElementById('statusFilter')?.value || "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î";
    const doctorFilter = document.getElementById('doctorFilter')?.value || "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î";
    appRowsPerPage = parseInt(document.getElementById('appPageSize')?.value) || 10;

    const formatDateTH = (dateStr) => {
        if (!dateStr) return "-";
        const [y, m, d] = dateStr.split("-");
        return `${d}-${m}-${y}`;
    };

    // 1. ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    let filteredData = appointments.filter(ap => {
        const matchSearch = ap.customerName.toLowerCase().includes(currentSearch.toLowerCase()) || 
                           (ap.hn && ap.hn.toLowerCase().includes(currentSearch.toLowerCase()));
        const matchStatus = statusFilter === "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" || ap.status === statusFilter;
        const matchDate = !dateFilter || ap.date === dateFilter;
        return matchSearch && matchStatus && matchDate;
    });

    filteredData.sort((a, b) => a.time.localeCompare(b.time));

    const totalPages = Math.ceil(filteredData.length / appRowsPerPage) || 1;
    const startIndex = (currentAppPage - 1) * appRowsPerPage;
    const paginatedData = filteredData.slice(startIndex, startIndex + appRowsPerPage);

target.innerHTML = `
    <div class="animate-in fade-in duration-500 font-normal uppercase">
        <div class="glass-card mb-8 border border-pink-200 shadow-sm p-4 rounded-3xl font-normal">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex flex-wrap gap-2 items-center flex-1">
                    <select id="appPageSize" onchange="currentAppPage=1; renderAppointmentPage()" class="border border-pink-200 px-3 py-2 rounded-xl text-[10px] outline-none bg-white font-normal">
                        <option value="10" ${appRowsPerPage==10?'selected':''}>10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>
                        <option value="30" ${appRowsPerPage==30?'selected':''}>30 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>
                    </select>
                    <select id="statusFilter" onchange="currentAppPage=1; renderAppointmentPage()" class="border border-pink-200 px-3 py-2 rounded-xl text-[10px] outline-none bg-white font-normal">
                        <option value="‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ${statusFilter === '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ? 'selected' : ''}>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" ${statusFilter === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' ? 'selected' : ''}>üü° ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                        <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô" ${statusFilter === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' ? 'selected' : ''}>üü¢ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                        <option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" ${statusFilter === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' ? 'selected' : ''}>üî¥ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                        <option value="‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡∏î" ${statusFilter === '‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡∏î' ? 'selected' : ''}>üîµ ‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡∏î</option>
                    </select>
                    <input type="date" id="filterDate" onchange="currentAppPage=1; renderAppointmentPage()" value="${dateFilter}" class="border border-pink-200 px-3 py-2 rounded-xl text-[10px] outline-none bg-white font-normal">
                    
                    <div class="relative flex items-center min-w-[200px]">
                        <input id="appSearchInput" type="text" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏ä‡∏∑‡πà‡∏≠ / HN" value="${currentSearch}" 
                            onkeyup="if(event.key === 'Enter') { currentAppPage=1; renderAppointmentPage(); }"
                            class="w-full border border-pink-200 px-4 py-2 rounded-xl text-[10px] outline-none bg-white pr-14 font-normal">
                        <button onclick="currentAppPage=1; renderAppointmentPage()" class="absolute right-1 top-1 bottom-1 bg-black text-white px-3 rounded-lg hover:brightness-125 transition-all text-[9px] font-normal">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                    </div>
                </div>
                
                <div class="flex gap-2">
                    <button onclick="printDailyReport()" class="w-28 bg-slate-100 text-slate-500 px-4 py-2 rounded-xl text-[9px] uppercase tracking-tighter font-normal">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏±‡∏î</button>
                    <button onclick="openAppointmentModal()" class="w-28 bg-black text-white px-4 py-2 rounded-xl text-[9px] uppercase tracking-tighter font-normal">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</button>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-[3rem] shadow-2xl border border-pink-200 overflow-hidden font-normal">
            <table class="w-full text-center text-xs border-collapse font-normal">
                <thead class="bg-[#D48197] text-white">
                    <tr>
                        <th class="p-2 font-normal w-[40px]">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</th>
                        <th class="p-2 font-normal w-[40px]">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                        <th class="p-2 font-normal">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà / ‡πÄ‡∏ß‡∏•‡∏≤</th>
                        <th class="p-2 font-normal">HN</th>
                        <th class="p-2 font-normal text-left">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                        <th class="p-2 font-normal">‡πÇ‡∏î‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå</th>
                        <th class="p-2 font-normal w-[60px]">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
                        <th class="p-2 font-normal">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™</th>
                        <th class="p-2 font-normal">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th class="p-2 font-normal">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody class="text-slate-600 font-normal">
                    ${paginatedData.length > 0 ? paginatedData.map((ap, i) => `
                        <tr class="border-b border-pink-50 hover:bg-pink-50/20 font-normal">
                            <td class="p-1 font-normal">
                                <button onclick="toggleConfirmApp(${startIndex + i})" 
                                    class="w-5 h-5 rounded-full border transition-all flex items-center justify-center mx-auto
                                    ${ap.isConfirm ? 'bg-[#D48197] border-[#D48197] text-white' : 'border-slate-300 text-slate-300'}">
                                    <span style="font-size: 8px;">‚úîÔ∏è</span>
                                </button>
                            </td>
                            <td class="p-1 text-[10px] font-normal text-center">${startIndex + i + 1}</td>
                            <td class="p-1 text-[10px] font-normal text-center">${formatDateTH(ap.date)}<br><span class="text-[#FF4B91] font-normal">${ap.time} ‡∏ô.</span></td>
                            <td class="p-1 text-slate-800 font-normal text-center">${ap.hn}</td>
                            <td class="p-1 text-slate-700 text-sm text-left font-normal">${ap.customerName}</td>
                            <td class="p-1 text-slate-500 font-normal text-center">‡∏û‡∏ç.${ap.doctor}</td>
                            <td class="p-1 text-[10px] text-slate-400 font-normal text-center">${ap.staff || '-'}</td>
                            <td class="p-1 text-slate-800 text-[11px] text-left font-normal">
                                <div class="flex flex-col gap-0 font-normal">
                                    ${ap.course ? ap.course.split(', ').map(c => `<span>‚Ä¢ ${c}</span>`).join('') : '-'}
                                </div>
                            </td>
                            <td class="p-1 font-normal text-center">
                                <span class="text-[10px] font-normal uppercase ${
                                    ap.status === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' ? 'text-yellow-500' : 
                                    ap.status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' ? 'text-green-600' : 
                                    ap.status === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' ? 'text-red-500' : 
                                    ap.status === '‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡∏î' ? 'text-blue-500' : 'text-slate-400'
                                }">${ap.status}</span>
                            </td>
                            <td class="p-1 relative font-normal text-center">
                                <div class="inline-flex items-center bg-[#D48197] text-white rounded-full p-1 shadow-md font-normal">
                                    <button onclick="editAppointment(${startIndex + i})" class="px-4 py-1 text-[10px] border-r border-white/30 hover:bg-white/10 rounded-l-full uppercase font-normal">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                    <button onclick="toggleAppActionMenu(event, ${startIndex + i})" class="px-2 py-1 text-[10px] hover:bg-white/10 rounded-r-full transition-all font-normal">‚ñº</button>
                                    
<div id="app-action-menu-${startIndex + i}" class="hidden absolute right-0 top-12 w-52 bg-white border border-pink-200 rounded-2xl shadow-2xl z-[999] overflow-hidden text-left text-slate-600 font-normal">
    <button onclick="alert('üîÑ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß')" class="w-full p-4 text-[10px] text-green-600 hover:bg-green-50 border-b flex items-center gap-2 font-normal uppercase">üîÑ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß</button>
    
    <button onclick="alert('üóìÔ∏è ‡∏î‡∏π‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')" class="w-full p-4 text-[10px] hover:bg-pink-50 border-b flex items-center gap-2 uppercase font-normal">üóìÔ∏è ‡∏î‡∏π‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    
    <button onclick="printAppointmentTicket(${startIndex + i})" class="w-full p-4 text-[10px] text-blue-600 hover:bg-blue-50 border-b flex items-center gap-2 font-normal uppercase">üìÑ ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏±‡∏ï‡∏£‡∏ô‡∏±‡∏î</button>
    <button onclick="deleteAppointment(${startIndex + i})" class="w-full p-4 text-[10px] text-red-500 hover:bg-red-50 flex items-center gap-2 font-normal uppercase">üóëÔ∏è ‡∏•‡∏ö‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</button>
</div>
                                </div>
                            </td>
                        </tr>`).join('') : `<tr><td colspan="10" class="p-20 text-center text-slate-300 italic font-normal">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢...</td></tr>`}
                </tbody>
            </table>
        </div>
        
        <div class="flex justify-center items-center gap-4 mt-8 mb-10 font-normal">
            <button onclick="changeAppPage(-1)" ${currentAppPage === 1 ? 'disabled' : ''} class="px-6 py-2 bg-white border border-pink-200 rounded-2xl disabled:opacity-30 text-[10px] hover:bg-pink-50 font-normal">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
            <span class="text-[11px] text-[#D48197] font-normal">‡∏´‡∏ô‡πâ‡∏≤ ${currentAppPage} / ${totalPages}</span>
            <button onclick="changeAppPage(1)" ${currentAppPage === totalPages ? 'disabled' : ''} class="px-6 py-2 bg-white border border-pink-200 rounded-2xl disabled:opacity-30 text-[10px] hover:bg-pink-50 font-normal">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
        </div>
    </div>`;
};
window.printAppointmentTicket = function(index) {
    // ‡∏î‡∏∂‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    const db = JSON.parse(localStorage.getItem('appointmentDB')) || [];
    const ap = db[index];
    if(!ap) return;

    // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡∏ß-‡∏î-‡∏õ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå
    const d = ap.date.split("-");
    const formattedDate = `${d[2]}-${d[1]}-${d[0]}`;

    const p = window.open('', '_blank');
    p.document.write(`
        <html>
            <body style="font-family:Sarabun,sans-serif;text-align:center;padding:40px;">
                <div style="border:2px dashed #FF4B91;padding:30px;border-radius:30px;display:inline-block;text-align:left;width:300px;">
                    <h2 style="color:#FF4B91;text-align:center;">ACE CLINIC</h2>
                    <hr style="border:0.5px solid #eee;">
                    <b>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</b> ${ap.customerName}<br>
                    <b>HN:</b> ${ap.hn}<br>
                    <b>‡∏ô‡∏±‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</b> ${formattedDate} ${ap.time} ‡∏ô.<br>
                    <b>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™:</b> ${ap.course || '-'}<br>
                    <hr style="border:0.5px solid #eee;">
                    <center><small>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏î 10 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏∞</small></center>
                </div>
                <script>window.print();window.close();<\/script>
            </body>
        </html>
    `);
    p.document.close();
};


// 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏ß‡∏≤ + ‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå Google + ‡∏ä‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏)
window.openAppointmentModal = function(editIndex = null) {
    const appointments = JSON.parse(localStorage.getItem('appointmentDB')) || [];
    const editData = editIndex !== null ? appointments[editIndex] : null;
    selectedCoursesForApp = editData ? editData.course.split(', ') : [];

    const modalWrap = document.createElement('div');
    modalWrap.id = "appModal";
    modalWrap.className = "fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[9999] animate-in fade-in duration-300 font-normal";
    
    modalWrap.innerHTML = `
        <div class="bg-white w-full max-w-2xl rounded-[3rem] p-12 shadow-2xl border border-pink-200 animate-in zoom-in duration-300 overflow-y-auto max-h-[95vh] font-normal">
            <div class="flex justify-between items-center mb-10 font-normal">
                <h3 class="text-3xl font-black text-slate-800 uppercase tracking-tighter font-normal">${editData ? 'üìù ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢' : '‚ú® ‡∏•‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤'}</h3>
                <button onclick="closeAppModal()" class="text-slate-300 hover:text-pink-50 transition-all text-3xl font-light font-normal">‚úï</button>
            </div>
            <div class="space-y-5 text-left font-bold uppercase font-normal">
                <div class="relative font-normal">
                    <label class="text-[11px] text-[#FF4B91] ml-2 block font-normal">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / HN</label>
                    <input type="text" id="appCustSearch" value="${editData ? editData.customerName : ''}" oninput="searchCustomerForApp(this.value)" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç HN..." class="w-full border border-pink-200 p-4 rounded-2xl outline-none focus:border-[#FF4B91] text-sm bg-white font-normal">
                    <div id="appCustResults" class="absolute left-0 right-0 bg-white shadow-2xl rounded-2xl mt-1 hidden border border-pink-100 max-h-48 overflow-y-auto z-[10001] font-normal"></div>
                </div>
                <div class="grid grid-cols-2 gap-6 font-normal">
                    <div class="font-normal">
                        <label class="text-[11px] text-[#FF4B91] ml-2 block font-normal">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</label>
                        <input type="date" id="appDate" value="${editData ? editData.date : ''}" class="w-full border border-pink-200 p-4 rounded-2xl outline-none text-sm bg-white font-normal">
                    </div>

                    <div class="font-normal">
                        <label class="text-[11px] text-[#FF4B91] ml-2 block font-normal">‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏î</label>
                        <div class="flex gap-1 font-normal">
                            <select id="appHour" class="w-1/2 border border-pink-200 p-4 rounded-2xl text-sm font-normal">
                                ${Array.from({length: 24}, (_, i) => `<option value="${String(i).padStart(2,'0')}" ${editData && editData.time.split(':')[0] == i ? 'selected' : ''}>${String(i).padStart(2,'0')}</option>`).join('')}
                            </select>
                            <select id="appMin" class="w-1/2 border border-pink-200 p-4 rounded-2xl text-sm font-normal">
                                <option value="00" ${editData && editData.time.split(':')[1] == '00' ? 'selected' : ''}>00</option>
                                <option value="10" ${editData && editData.time.split(':')[1] == '10' ? 'selected' : ''}>10</option>
                                <option value="20" ${editData && editData.time.split(':')[1] == '20' ? 'selected' : ''}>20</option>
                                <option value="30" ${editData && editData.time.split(':')[1] == '30' ? 'selected' : ''}>30</option>
                                <option value="40" ${editData && editData.time.split(':')[1] == '40' ? 'selected' : ''}>40</option>
                                <option value="50" ${editData && editData.time.split(':')[1] == '50' ? 'selected' : ''}>50</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-6 font-normal">
                    <div class="font-normal">
                        <label class="text-[11px] text-[#FF4B91] ml-2 block font-normal">‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</label>
                        <select id="appDoc" class="w-full border border-pink-200 p-4 rounded-2xl text-sm font-normal bg-white font-normal">
                            <option value="‡∏´‡∏°‡∏≠‡πÅ‡∏Å‡πâ‡∏ß" ${editData && editData.doctor === '‡∏´‡∏°‡∏≠‡πÅ‡∏Å‡πâ‡∏ß' ? 'selected' : ''}>‡∏û‡∏ç.‡πÅ‡∏Å‡πâ‡∏ß</option>
                            <option value="‡∏´‡∏°‡∏≠‡∏õ‡∏•‡∏≤" ${editData && editData.doctor === '‡∏´‡∏°‡∏≠‡∏õ‡∏•‡∏≤' ? 'selected' : ''}>‡∏û‡∏ç.‡∏õ‡∏•‡∏≤</option>
                        </select>
                    </div>
                    <div class="font-normal">
                        <label class="text-[11px] text-[#FF4B91] ml-2 block font-normal">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</label>
                        <select id="appStatus" class="w-full border border-pink-200 p-4 rounded-2xl text-sm font-normal bg-white font-normal">
                            <option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" ${editData && editData.status === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' ? 'selected' : ''}>üü° ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô" ${editData && editData.status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' ? 'selected' : ''}>üü¢ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                            <option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" ${editData && editData.status === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' ? 'selected' : ''}>üî¥ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                            <option value="‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡∏î" ${editData && editData.status === '‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡∏î' ? 'selected' : ''}>üîµ ‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡∏î</option>
                        </select>
                    </div>
                </div>
                <div class="font-normal">
                    <label class="text-[11px] text-[#FF4B91] ml-2 block font-normal">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏≥</label>
                    <input type="text" id="appStaff" value="${editData ? editData.staff : ''}" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô" class="w-full border border-pink-200 p-4 rounded-2xl text-sm font-normal mb-2 bg-white font-normal">
                    <div class="relative font-normal">
    <label class="text-[11px] text-[#FF4B91] ml-2 block font-normal">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™</label>
    <input type="text" id="appCourse" onfocus="searchCourseForApp()" oninput="searchCourseForApp()" placeholder="‡∏à‡∏¥‡πâ‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™..." class="w-full border border-pink-200 p-4 rounded-2xl outline-none text-sm bg-white font-normal">
    <div id="appCourseResults" class="absolute left-0 right-0 bg-white shadow-2xl rounded-2xl mt-1 hidden border border-pink-100 max-h-48 overflow-y-auto z-[10001] font-normal"></div>
    <div id="selectedCoursesContainer" class="mt-3 flex flex-wrap gap-2 pr-2 font-normal"></div>
</div>


<div class="font-normal">
    <label class="text-[11px] text-[#FF4B91] ml-2 block font-normal">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
    <textarea id="appNote" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..." class="w-full border border-pink-200 p-4 rounded-2xl text-sm font-normal h-24 resize-none bg-white font-normal">${editData ? editData.note : ''}</textarea>
</div>
                </div>
                <div class="flex items-center justify-between p-4 bg-slate-50 rounded-2xl font-normal">
                    <span class="text-[10px] text-slate-500 font-bold font-normal tracking-wider">üóìÔ∏è ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏î‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô Google ‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</span>
                    <label class="relative inline-flex items-center cursor-pointer font-normal">
                        <input type="checkbox" id="syncGoogle" class="sr-only peer font-normal">
                        <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:bg-[#FF4B91] after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all font-normal"></div>
                    </label>
                </div>
                <div class="flex justify-end mt-4 font-normal font-normal">
                    <button onclick="saveNewAppointment(${editIndex})" class="bg-black text-white px-8 py-3 rounded-2xl font-black shadow-xl hover:scale-[1.02] transition-all text-[11px] font-normal uppercase tracking-widest font-normal">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modalWrap);
    if(!editData) {
        document.getElementById('appDate').valueAsDate = new Date();
    } else {
        renderSelectedCourses();
    }
};

// 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤/‡∏û‡∏¥‡∏°‡∏û‡πå/‡∏•‡∏ö/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤)
window.changeAppPage = function(step) { currentAppPage += step; renderAppointmentPage(); };

window.printAppointmentTicket = function(index) {
    // ‡∏î‡∏∂‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    const db = JSON.parse(localStorage.getItem('appointmentDB')) || [];
    const ap = db[index];
    if(!ap) return;

    // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡∏ß-‡∏î-‡∏õ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå
    const d = ap.date.split("-");
    const formattedDate = `${d[2]}-${d[1]}-${d[0]}`;

    const p = window.open('', '_blank');
    p.document.write(`
        <html>
            <body style="font-family:Sarabun,sans-serif;text-align:center;padding:40px;">
                <div style="border:2px dashed #FF4B91;padding:30px;border-radius:30px;display:inline-block;text-align:left;width:300px;">
                    <h2 style="color:#FF4B91;text-align:center;">ACE CLINIC</h2>
                    <hr style="border:0.5px solid #eee;">
                    <b>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</b> ${ap.customerName}<br>
                    <b>HN:</b> ${ap.hn}<br>
                    <b>‡∏ô‡∏±‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</b> ${formattedDate} ${ap.time} ‡∏ô.<br>
                    <b>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™:</b> ${ap.course || '-'}<br>
                    <hr style="border:0.5px solid #eee;">
                    <center><small>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏î 10 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏∞</small></center>
                </div>
                <script>window.print();window.close();<\/script>
            </body>
        </html>
    `);
    p.document.close();
};

window.searchCustomerForApp = function(val) {
    const resDiv = document.getElementById('appCustResults');
    if (!val) { resDiv.classList.add('hidden'); return; }
    const db = JSON.parse(localStorage.getItem('customerDB')) || [];
    const matches = db.filter(c => c.fullname.toLowerCase().includes(val.toLowerCase()) || c.hn.toLowerCase().includes(val.toLowerCase()));
    if (matches.length > 0) {
        resDiv.innerHTML = matches.map(c => `<div onclick="selectCustForApp('${c.fullname}', '${c.hn}')" class="p-4 hover:bg-pink-50 cursor-pointer border-b border-pink-50 flex justify-between font-normal"><span class="text-sm font-bold">${c.fullname}</span><span class="text-[10px] bg-slate-100 px-2 py-1 rounded-full uppercase font-bold">${c.hn}</span></div>`).join('');
        resDiv.classList.remove('hidden');
    } else { resDiv.classList.add('hidden'); }
};

window.selectCustForApp = function(name, hn) {
    const inp = document.getElementById('appCustSearch');
    inp.value = name; inp.dataset.hn = hn;
    document.getElementById('appCustResults').classList.add('hidden');
    selectedCoursesForApp = []; renderSelectedCourses();
};

window.searchCourseForApp = function() {
    const resDiv = document.getElementById('appCourseResults');
    const hn = document.getElementById('appCustSearch').dataset.hn;
    if (!hn) { alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏∞"); return; }
    const db = JSON.parse(localStorage.getItem('customerDB')) || [];
    const customer = db.find(c => c.hn === hn);
    const courses = customer ? customer.courses || [] : [];
    if (courses.length > 0) {
        resDiv.innerHTML = courses.map(c => {
            const total = c.totalAmount || 10;
            const currentRound = (total - c.amount) + 1;
            return `<div onclick="selectCourseForApp('${c.name}', ${currentRound}, ${total})" class="p-4 hover:bg-pink-50 cursor-pointer border-b border-pink-50 flex justify-between font-normal"><span class="text-sm font-bold">${c.name}</span><span class="text-[10px] text-pink-400 font-bold">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${currentRound}/${total}</span></div>`;
        }).join('');
        resDiv.classList.remove('hidden');
    } else { resDiv.innerHTML = `<div class="p-4 text-center text-slate-300 text-xs font-normal">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏™‡∏∞‡∏™‡∏°</div>`; resDiv.classList.remove('hidden'); }
};

window.selectCourseForApp = function(name, round, total) {
    const courseText = `${name} (${round}/${total})`;
    if (!selectedCoursesForApp.includes(courseText)) {
        selectedCoursesForApp.push(courseText); renderSelectedCourses();
    }
    document.getElementById('appCourseResults').classList.add('hidden');
    document.getElementById('appCourse').value = "";
};

window.renderSelectedCourses = function() {
    const container = document.getElementById('selectedCoursesContainer');
    if (container) {
        container.innerHTML = selectedCoursesForApp.map((c, i) => `<div class="bg-pink-50 text-[#FF4B91] border border-pink-200 px-3 py-1.5 rounded-xl text-[10px] font-bold flex items-center gap-2 font-normal animate-in slide-in-from-left"><span>‚ú® ${c}</span><button onclick="removeCourseFromApp(${i})" class="hover:text-red-500 font-normal">‚úï</button></div>`).join('');
    }
};

window.removeCourseFromApp = function(i) {
    selectedCoursesForApp.splice(i, 1); renderSelectedCourses();
};

window.saveNewAppointment = function(editIndex = null) {
    const hnInput = document.getElementById('appCustSearch');
    const name = hnInput.value;
    if (!name || selectedCoursesForApp.length === 0) { alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏Ñ‡πà‡∏∞"); return; }
    const newApp = {
        hn: hnInput.dataset.hn || "‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ", customerName: name, date: document.getElementById('appDate').value,
        time: document.getElementById('appHour').value + ":" + document.getElementById('appMin').value,
        doctor: document.getElementById('appDoc').value, staff: document.getElementById('appStaff').value || "-",
        course: selectedCoursesForApp.join(', '), status: document.getElementById('appStatus').value,
        note: document.getElementById('appNote').value, createdAt: new Date().getTime()
    };
    let db = JSON.parse(localStorage.getItem('appointmentDB')) || [];
    if (editIndex !== null && editIndex !== undefined && editIndex !== "") db[editIndex] = newApp; 
    else db.push(newApp);
    localStorage.setItem('appointmentDB', JSON.stringify(db));
    alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"); closeAppModal(); renderAppointmentPage();
};

window.deleteAppointment = function(index) {
    if(confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
        let db = JSON.parse(localStorage.getItem('appointmentDB')) || [];
        db.splice(index, 1); localStorage.setItem('appointmentDB', JSON.stringify(db));
        renderAppointmentPage();
    }
};

window.toggleAppActionMenu = function(event, index) {
    event.stopPropagation();
    const menuId = `app-action-menu-${index}`;
    document.querySelectorAll("[id^='app-action-menu-']").forEach(m => { if(m.id !== menuId) m.classList.add('hidden'); });
    const currentMenu = document.getElementById(menuId);
    if(currentMenu) currentMenu.classList.toggle('hidden');
};

window.editAppointment = function(index) { openAppointmentModal(index); };
window.closeAppModal = function() { const m = document.getElementById('appModal'); if (m) m.remove(); };
document.addEventListener('click', () => { document.querySelectorAll("[id^='app-action-menu-']").forEach(m => m.classList.add('hidden')); });

window.printDailyReport = function() {
    const appointments = JSON.parse(localStorage.getItem('appointmentDB')) || [];
    const dateFilter = document.getElementById('filterDate')?.value;
    
    if (!dateFilter) {
        alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏∞");
        return;
    }

    const dailyList = appointments.filter(ap => ap.date === dateFilter);
    if (dailyList.length === 0) { alert("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"); return; }
    dailyList.sort((a, b) => a.time.localeCompare(b.time));

    const p = window.open('', '_blank');
    p.document.write(`
        <html>
            <head><style>
                body { font-family:Sarabun,sans-serif; padding:20px; }
                table { width:100%; border-collapse:collapse; margin-top:20px; }
                th, td { border:1px solid #ddd; padding:10px; text-align:center; font-size:14px; }
                th { background:#FFF0F5; color:#D48197; }
            </style></head>
            <body>
                <h1 style="text-align:center;color:#FF4B91;">ACE CLINIC</h1>
                <h3 style="text-align:center;">‡πÉ‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${dateFilter.split('-').reverse().join('-')}</h3>
                <table>
                    <thead><tr><th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™</th><th>‡πÅ‡∏û‡∏ó‡∏¢‡πå</th><th>‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th></tr></thead>
                    <tbody>
                        ${dailyList.map((ap, i) => `
                            <tr>
                                <td>${i + 1}</td>
                                <td><b>${ap.time}</b></td>
                                <td style="text-align:left;">${ap.customerName}</td>
                                <td style="text-align:left;font-size:12px;">${ap.course || '-'}</td>
                                <td>${ap.doctor}</td>
                                <td style="width:120px;"></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <script>window.print();window.close();<\/script>
            </body>
        </html>
    `);
    p.document.close();
};

window.toggleConfirmApp = function(index) {
    let db = JSON.parse(localStorage.getItem('appointmentDB')) || [];
    if (db[index]) {
        // ‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏° (‡∏à‡∏£‡∏¥‡∏á/‡πÄ‡∏ó‡πá‡∏à)
        db[index].isConfirm = !db[index].isConfirm; 
        localStorage.setItem('appointmentDB', JSON.stringify(db));
        // ‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
        renderAppointmentPage(); 
    }
};

/* --- ‚ú® ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å OPD ‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ü‡∏≠‡∏£‡πå‡∏°) --- */
window.saveTreatmentHistory = function(index) {
    const typeSelect = document.getElementById('opdTypeSelector');
    const selectedType = typeSelect ? typeSelect.value : 'general';
    let detailToSave = "";

    // 1. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏â‡∏µ‡∏î‡∏ú‡∏¥‡∏ß" ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á 14 ‡∏ä‡πà‡∏≠‡∏á
    if (selectedType === 'skin_injection') {
        const tables = document.querySelectorAll('#opd-dynamic-layout table');
        let records = [];
        tables.forEach(table => {
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const courseText = row.cells[2].innerText.trim();
                if (courseText) {
                    records.push(`‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${row.cells[0].innerText}: ${courseText}`);
                }
            });
        });
        detailToSave = records.length > 0 ? "üíâ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏â‡∏µ‡∏î‡∏ú‡∏¥‡∏ß:\n" + records.join("\n") : "";
    } 
    // 2. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Botox ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏Ç‡∏≠‡∏î ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
    else {
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        const notes = document.getElementById('treatmentNotes');
        detailToSave = notes ? notes.value.trim() : "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£ (‡∏ß‡∏≤‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏•‡∏á‡πÉ‡∏ô‡πÉ‡∏ö OPD)";
    }

    if (!detailToSave) {
        alert("‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏∞");
        return;
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
    const record = {
        date: new Date().toLocaleDateString('th-TH'),
        time: new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' }),
        detail: detailToSave,
        fileName: `OPD_${selectedType.toUpperCase()}_${Date.now()}`
    };

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÉ‡∏ô Array treatments ‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡πÜ
    if (!customerDB[index].treatments) customerDB[index].treatments = [];
    customerDB[index].treatments.push(record);

    // ‡πÄ‡∏ã‡∏ü‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å (localStorage)
    localStorage.setItem('customerDB', JSON.stringify(customerDB));
    
    alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏•‡∏á‡∏´‡∏ô‡πâ‡∏≤ '‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö' ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞!");
};
/* --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå --- */
window.prepareAndPrintOPD = function() {
    const notes = document.getElementById('treatmentNotes').value;
    document.getElementById('printableNotesDisplay').innerText = notes;
    window.print();
};
/* --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏°: ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤ --- */
window.deleteTreatmentRecord = function(customerIndex, recordIndex) {
    if(confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
        customerDB[customerIndex].treatments.splice(recordIndex, 1);
        localStorage.setItem('customerDB', JSON.stringify(customerDB));
        // ‡∏™‡∏±‡πà‡∏á‡∏ß‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        switchProfileTab(4, customerIndex);
    }
};

</script>
</body>
</html>
